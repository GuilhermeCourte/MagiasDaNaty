<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Produtos - Sodiê Doces</title>
    <link id="favicon-link" rel="icon" href="default-favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sodiePrimary: 'var(--color-primary, #6E1C44)',
                        sodieSecondary: '#F8F8F8', // Mantém-se estática
                        sodieAccent: 'var(--color-accent, #F3C555)', // Agora é dinâmica
                        sodieText: '#333333',
                        sodieLightText: '#FFFFFF',
                        whatsappGreen: '#25D366',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        heading: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style id="dynamic-colors"></style>
    <style>

    

        .header-shadow { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); }
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: #fefefe; margin: auto; padding: 20px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 90%; 
            max-width: 500px; /* Limita a largura máxima dos modais */
            text-align: center;
        }
        .close-button {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; }
        
        /* Estilos para Upload de Imagem */
        .file-upload-wrapper {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .file-upload-wrapper:hover {
            border-color: var(--color-primary, #6E1C44);
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
        }
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
        }
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .remove-image-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid white;
        }
        .upload-spinner {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--color-primary, #6E1C44);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Estilos para Filtro de Categoria no CRUD */
        .filter-btn {
            padding: 0.25rem 1rem;
            border-radius: 9999px;
            border: 1px solid #ddd;
            color: #333;
            background-color: #f9f9f9;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .filter-btn:hover {
            background-color: #eee;
            border-color: #ccc;
        }
        .filter-btn.active {
            background-color: var(--color-primary, #6E1C44);
            color: white;
            border-color: var(--color-primary, #6E1C44);
        }


        /* Estilos para o Interruptor (Toggle Switch) */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #22c55e; }
        input:checked + .slider:before { transform: translateX(22px); }



        /* Estilos para a navegação do CRUD */
        .crud-nav-btn {
            padding: 2.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #333333; /* sodieText */
            background-color: white;
            border: 2px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            text-align: center;
        }
        .crud-nav-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-lg */
            border-color: var(--color-primary, #6E1C44);
            color: var(--color-primary, #6E1C44);
        }
        .crud-nav-btn.active {
            background-color: var(--color-primary, #6E1C44); /* sodiePrimary */
            color: white;
            border-color: var(--color-primary, #6E1C44);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }


            @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .animate-fade-out {
            animation: fadeOut 0.3s ease-in forwards;
        }


        /* Estilos para o seletor de DDI */
        .ddi-select-wrapper {
            position: relative;
            flex-shrink: 0;
        }
        .ddi-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-left: 3.5rem; /* Espaço aumentado para o SVG */
            background-image: none;
            border-radius: 0.375rem 0 0 0.375rem;
            border-right: none;
        }
        .ddi-flag {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none; /* Permite clicar no select */
            
        }


        /* Estilos para o seletor de horário de atendimento */
        .day-selector {
            display: flex;
            align-items: center;
            gap: 1.5rem; /* Espaço entre o dia e os horários */
        }
        .day-selector-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            width: 120px; /* Largura fixa para alinhar os horários */
            flex-shrink: 0;
        }
        .time-inputs {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .time-inputs input {
            width: 100px; /* Largura aumentada para caber os números */
            text-align: center;
        }
        .time-inputs input:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .day-selector-label input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--color-primary, #6E1C44);
        }

       /* Animação para o título principal */
       @keyframes title-in {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}
        .animate-title-in {
            animation: title-in 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
        }


/* Estilos para a ferramenta de aplicar horário em lote */
        .hours-applicator {
            background-color: #f9fafb; /* bg-gray-50 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            padding: 1rem;
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 1.5rem;
        }
        .applicator-days {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .applicator-days label {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }

               /* Estilo para o número de ordem do banner */
        .banner-order-number {
            position: absolute;
            top: 0.5rem; /* 8px */
            left: 0.5rem; /* 8px */
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            width: 1.75rem; /* 28px */
            height: 1.75rem; /* 28px */
            border-radius: 9999px; /* rounded-full */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem; /* text-sm */
            border: 2px solid white;
            z-index: 10;
        }

/* Estilos para o seletor de cores */
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        .color-picker-input {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 50px;
            height: 50px;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        .color-picker-input::-webkit-color-swatch {
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
        }
        .color-picker-input::-moz-color-swatch {
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
        }

        /* Estilos para o Acordeão (Gavetas) */
        .accordion-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #f9fafb; /* bg-gray-50 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .accordion-header:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        .accordion-icon {
            transition: transform 0.3s ease-out;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            background-color: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        .accordion-content-inner {
            padding: 1.5rem;
        }
        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

      

/* Estilos para o painel de pré-visualização de cores (VERSÃO ATUALIZADA) */
.preview-flex-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
    gap: 2rem;
    background-color: #f0f2f5;
    padding: 2rem;
    border-radius: 0.5rem;
}

.preview-item-wrapper {
    text-align: center;
}

.preview-item-label {
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    font-size: 0.75rem;
}

.preview-text-box, .preview-button-box {
    background-color: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    width: 280px;
    height: 100%;
}

.preview-text-heading {
    font-size: 1.25rem;
    font-weight: 700;
    font-family: 'Playfair Display', serif;
    margin-bottom: 0.5rem;
    color: var(--preview-color-primary, #6E1C44); /* Cor primária */
    transition: color 0.3s ease;
}

.preview-text-body {
    font-size: 0.875rem;
    color: #666;
    line-height: 1.5;
}

.preview-button-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
}

.preview-button {
    width: 80%;
    padding: 0.75rem;
    border: none;
    border-radius: 9999px;
    font-weight: 600;
    cursor: pointer;
    color: white;
    background-color: var(--preview-color-primary, #6E1C44); /* Cor primária */
    transition: background-color 0.3s ease;
}

.preview-button:hover {
    background-color: var(--preview-color-accent, #F3C555); /* Cor de destaque */
}

.preview-cart-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 56px; /* 14 * 4 */
    height: 56px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    color: white;
    background-color: var(--preview-color-primary, #6E1C44); /* Cor primária */
    transition: background-color 0.3s ease;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.preview-cart-button:hover {
    background-color: var(--preview-color-accent, #F3C555); /* Cor de destaque */
}



    </style>
</head>
<body class="font-sans bg-sodieSecondary text-sodieText min-h-screen flex flex-col">

    <!-- INÍCIO DO CABEÇALHO ATUALIZADO E FIXO -->
<header id="main-header" class="bg-white py-4 sticky top-0 z-50 shadow-md">
    <!-- O conteúdo interno do header (logo, navegação, ícones) permanece o mesmo -->
    <div class="container mx-auto grid grid-cols-3 items-center px-4 md:px-8">
        <!-- Esquerda: Logo -->
        <div class="justify-self-start">
            <a href="index.html" class="flex items-center">
<img src="" alt="" class="h-10 md:h-12 site-logo">
            </a>
        </div>

        <!-- Centro: Navegação -->
        <nav class="hidden md:flex items-center justify-center space-x-6 lg:space-x-8 text-sodieText font-medium text-lg">
            <a href="index.html" class="hover:text-sodiePrimary transition duration-300">HOME</a>
            <a href="#" class="hover:text-sodiePrimary transition duration-300">SOBRE NÓS</a>
            <a href="#" class="hover:text-sodiePrimary transition duration-300">FALE CONOSCO</a>
        </nav>

        <!-- Direita: Ícones e Ações -->
        <div class="flex items-center space-x-4 justify-self-end">
            <a href="carrinho.html" class="hidden md:flex items-center text-sodieText font-medium text-lg hover:text-sodiePrimary transition duration-300">MEU CARRINHO</a>
            
            <button id="admin-login-btn" class="hidden text-sodiePrimary hover:text-sodieAccent transition duration-300">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            </button>

            <a href="crud.html" id="admin-gear-btn" class="hidden text-sodiePrimary hover:text-sodieAccent transition duration-300" title="Gerenciar Produtos">
                <svg class="w-7 h-7" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M20 6H10m0 0a2 2 0 1 0-4 0m4 0a2 2 0 1 1-4 0m0 0H4m16 6h-2m0 0a2 2 0 1 0-4 0m4 0a2 2 0 1 1-4 0m0 0H4m16 6H10m0 0a2 2 0 1 0-4 0m4 0a2 2 0 1 1-4 0m0 0H4"/>
                </svg>
            </a>
            <button id="logout-btn" class="hidden text-sodiePrimary hover:text-red-500 transition duration-300" title="Sair">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
            </button>

            <button id="mobile-menu-button" class="md:hidden text-sodiePrimary hover:text-sodieAccent transition duration-300">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>
    </div>
    <div id="mobile-menu" class="hidden md:hidden bg-white py-4 shadow-lg absolute w-full top-[72px]">
            <ul class="flex flex-col items-center space-y-4 text-sodieText font-medium">
                <li><a href="index.html" class="block py-2 hover:text-sodiePrimary transition duration-300">HOME</a></li>
                <li><a href="#" class="block py-2 hover:text-sodiePrimary transition duration-300">SOBRE NÓS</a></li>
                <li><a href="#" class="block py-2 hover:text-sodiePrimary transition duration-300">FALE CONOSCO</a></li>
                <li><a href="carrinho.html" class="block py-2 hover:text-sodiePrimary transition duration-300">MEU CARRINHO</a></li>
                <li id="mobile-admin-gear-li" class="hidden"><a href="crud.html" class="block py-2 hover:text-sodiePrimary transition duration-300">GERENCIAR PRODUTOS</a></li>
            </ul>
        </div>
</header>
<!-- FIM DO CABEÇALHO ATUALIZADO E FIXO -->



    <!-- TELA DE LOGIN -->
    <div id="login-screen" hidden>
        <div>
            <h2 class="text-3xl font-bold font-heading text-sodiePrimary text-center mb-6" hidden>Acesso Administrativo</h2>
            <form id="login-form" class="space-y-6" hidden>
                <div>
                    <label for="email" class="block text-sodieText text-lg font-medium mb-2" hidden></label>
                    <input type="email" id="email" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-sodiePrimary focus:border-sodiePrimary" hidden>
                </div>
                <div>
                    <label for="password" class="block text-sodieText text-lg font-medium mb-2"hidden></label>
                    <input type="password" id="password" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-sodiePrimary focus:border-sodiePrimary"hidden>
                </div>
                <div id="login-error" class="text-red-500 text-center font-medium hidden"hidden></div>
                <div class="flex justify-center"hidden>
                    <button type="submit" class="bg-sodiePrimary text-sodieLightText w-full px-6 py-3 rounded-full hover:bg-sodieAccent hover:text-sodieText transition duration-300 font-semibold"hidden>
                        
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- CONTEÚDO DO CRUD (ESCONDIDO POR PADRÃO) -->
    <div id="crud-content" class="hidden">
<main class="flex-grow container mx-auto pt-16 px-4 md:px-8">
        <!-- Cabeçalho do Painel com Botão de Voltar -->
        <div id="crud-main-header" class="relative flex items-center justify-center mb-20">
<button id="back-to-menu-btn" class="fixed top-28 left-4 md:left-8 z-50 text-sodiePrimary transition hidden flex-col items-center p-2 rounded-lg bg-white shadow-md hover:bg-gray-100">
<svg class="text-sodiePrimary" version="1.1" id="icons_1_" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 128 128" style="enable-background:new 0 0 128 128" xml:space="preserve"><style>.st0{display:none}.st1{display:inline}.st2{fill:#0a0a0a}</style><g id="row2_1_"><g id="_x32__4_"><path class="st2" d="M64 .3C28.7.3 0 28.8 0 64s28.7 63.7 64 63.7 64-28.5 64-63.7S99.3.3 64 .3zm0 121C32.2 121.3 6.4 95.7 6.4 64 6.4 32.3 32.2 6.7 64 6.7s57.6 25.7 57.6 57.3c0 31.7-25.8 57.3-57.6 57.3zm22.4-63.7H57.6l12.3-15.2c0-2.2-1.8-3.9-3.9-3.9h-7.1L32 64l26.8 25.5H66c2.2 0 3.9-1.8 3.9-3.9L57.1 69.9h28.6c2.2 0 3.9-1.8 3.9-3.9v-4c0-2.1-1-4.4-3.2-4.4z" id="left_1_"/></g></g></svg>
                <span class="text-sm font-semibold mt-1">Voltar</span>
            </button>   
            <h1 id="main-title" class="text-4xl font-bold font-heading text-sodiePrimary text-center">Painel de Gerenciamento </h1>
        </div>

        <!-- Navegação do CRUD com Ícones -->
        <div id="crud-nav" class="mb-12 grid grid-cols-1 md:grid-cols-3 gap-8">
            <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="products-section">
<img width="100" height="100" src="https://img.icons8.com/hands/100/shopping-basket.png" alt="shopping-basket"/>
                <span>Produtos</span>
            </button>
            <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="categories-section">
<img width="100" height="100" src="https://img.icons8.com/hands/100/price-tag.png" alt="price-tag"/>
                <span>Categorias</span>
            </button>
            <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="settings-section">
<img width="100" height="100" src="https://img.icons8.com/hands/100/service.png" alt="service"/>
                <span>Configurações do Site</span>
            </button>
        </div>

        <!-- Contentor para as Secções -->
        <div id="crud-sections-container">

            <!-- Secção 1: Configurações do Site (agora com um sub-menu) -->
            <div id="settings-section" class="crud-section hidden">
                <!-- Sub-menu de Configurações com Ícones -->
<div id="settings-submenu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
    <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="logo-content">
        <img width="100" height="100" src="https://img.icons8.com/hands/100/image.png" alt="image"/>
        <span>Logo</span>
    </button>
    <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="contact-content">
    <img width="100" height="100" src="https://img.icons8.com/hands/100/chat-bubble.png" alt="chat-bubble"/>
    <span class="mt-4">Contato</span>
</button>
    <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="banner-content">
        <img width="100" height="100" src="https://img.icons8.com/hands/100/stack-of-photos.png" alt="stack-of-photos"/>
        <span>Banner</span>
    </button>
    <button class="crud-nav-btn flex flex-col items-center justify-center" data-target="colors-content">
        <img width="100" height="100" src="https://img.icons8.com/hands/100/roller-brush.png" alt="roller-brush"/>
        <span>Cores</span>
    </button>
</div>

                <!-- Conteúdo das Sub-secções de Configurações (escondido por defeito) -->
                <div id="logo-content" class="settings-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-2xl mx-auto">
                        <h2 class="text-3xl font-semibold font-heading text-sodieText mb-4 flex gap-3">
                            <span>Gerenciamento de Logo</span>
                            <svg class="w-8 h-8 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        </h2>
                        
                        <form id="logo-add-form" class="space-y-4 mb-6">
                            <!-- INÍCIO DA ALTERAÇÃO -->
                            <div>
                                <label for="logo-name-add" class="block text-sodieText text-lg font-medium mb-2">Nome do Logo:</label>
                                <input type="text" id="logo-name-add" placeholder="Ex: Logo de Natal" required class="w-full p-3 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sodieText text-lg font-medium mb-2">Ficheiro da Imagem:</label>
                                <div id="logo-upload-wrapper" class="file-upload-wrapper !p-3 flex flex-col items-center justify-center">
                                    <svg class="w-12 h-12 text-gray-400 mb-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p>Clique para adicionar uma imagem</p>
                                    <input type="file" id="logo-file-add" accept="image/*" class="hidden">
                                </div>
                            </div>
                             <!-- FIM DA ALTERAÇÃO -->
                            <div id="logo-preview-container" class="image-preview-container"></div>
                            <div class="flex justify-end">
                                <button type="submit" id="save-logo-add-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full font-semibold">Adicionar Logo</button>
                            </div>
                        </form>
                        <hr class="my-6">
                         <p id="loading-logos-message" class="text-center text-gray-500">Carregando logos...</p>
                         <div id="logo-list" class="space-y-4 mt-4"></div>
                    </div> 
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-2xl mx-auto mt-8">
    <h2 class="text-3xl font-semibold font-heading text-sodieText mb-4 flex gap-3">
        <span>Gerenciamento de Favicon</span>
        <svg class="w-7 h-7 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
    </h2>
    <p class="text-gray-600 mb-6 text-sm">O favicon é o ícone na aba do navegador. Recomenda-se uma imagem quadrada (32x32px) em formato .png ou .ico.</p>
    
    <form id="favicon-add-form" class="space-y-4 mb-6">
        <div>
            <label for="favicon-name-add" class="block text-sodieText text-lg font-medium mb-2">Nome do Favicon:</label>
            <input type="text" id="favicon-name-add" placeholder="Ex: Favicon de Natal" required class="w-full p-3 border border-gray-300 rounded-md">
        </div>
        <div>
            <label class="block text-sodieText text-lg font-medium mb-2">Arquivo da Imagem:</label>
            <div id="favicon-upload-wrapper" class="file-upload-wrapper !p-3 flex flex-col items-center justify-center">
                <svg class="w-12 h-12 text-gray-400 mb-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                </svg>
                <p>Clique para adicionar uma imagem</p>
                <input type="file" id="favicon-file-input" accept="image/png, image/x-icon, image/vnd.microsoft.icon" class="hidden">
            </div>
        </div>
        <div id="favicon-preview-container" class="image-preview-container"></div>
        <div class="flex justify-end">
            <button type="submit" id="save-favicon-add-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full font-semibold">Adicionar Favicon</button>
        </div>
    </form>

    <hr class="my-6">
    
    <p id="loading-favicons-message" class="text-center text-gray-500">Carregando favicons...</p>
    <div id="favicon-list" class="space-y-4 mt-4">
        </div>
</div>
                    </div>
                    </div>
                </div>

            
               
                <div id="contact-content" class="settings-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-2xl mx-auto">
                        <h2 class="text-3xl font-semibold font-heading text-sodieText mb-4 flex gap-3">
                            <span>Gerenciamento de Contato</span>
                            <svg class="w-8 h-8 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        </h2>
                        <p class="text-gray-600 mb-6">Atualize as informações de contato que serão exibidas no rodapé.</p>
                        <form id="contact-form" class="space-y-6 text-left">
                            <div>
<div class="flex items-center gap-2 mb-2">
        <svg class="w-6 h-6" style="color: #25D366;" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 4a8 8 0 0 0-6.895 12.06l.569.718-.697 2.359 2.32-.648.379.243A8 8 0 1 0 12 4ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10a9.96 9.96 0 0 1-5.016-1.347l-4.948 1.382 1.426-4.829-.006-.007-.033-.055A9.958 9.958 0 0 1 2 12Z" clip-rule="evenodd"/><path d="M16.735 13.492c-.038-.018-1.497-.736-1.756-.83a1.008 1.008 0 0 0-.34-.075c-.196 0-.362.098-.49.291-.146.217-.587.732-.723.886-.018.02-.042.045-.057.045-.013 0-.239-.093-.307-.123-1.564-.68-2.751-2.313-2.914-2.589-.023-.04-.024-.057-.024-.057.005-.021.058-.074.085-.101.08-.079.166-.182.249-.283l.117-.14c.121-.14.175-.25.237-.375l.033-.066a.68.68 0 0 0-.02-.64c-.034-.069-.65-1.555-.715-1.711-.158-.377-.366-.552-.655-.552-.027 0 0 0-.112.005-.137.005-.883.104-1.213.311-.35.22-.94.924-.94 2.16 0 1.112.705 2.162 1.008 2.561l.041.06c1.161 1.695 2.608 2.951 4.074 3.537 1.412.564 2.081.63 2.461.63.16 0 .288-.013.4-.024l.072-.007c.488-.043 1.56-.599 1.804-1.276.192-.534.243-1.117.115-1.329-.088-.144-.239-.216-.43-.308Z"/></svg>
    <label class="block text-sodieText text-lg font-medium">WhatsApp Principal:</label>
</div>
                                <div class="flex items-center">
                                    <div class="ddi-select-wrapper">
                                        <div id="ddi-flag" class="ddi-flag">
<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect x="1" y="4" width="30" height="24" rx="4" ry="4" fill="#459a45"></rect><path d="M27,4H5c-2.209,0-4,1.791-4,4V24c0,2.209,1.791,4,4,4H27c2.209,0,4-1.791,4-4V8c0-2.209-1.791-4-4-4Zm3,20c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V8c0-1.654,1.346-3,3-3H27c1.654,0,3,1.346,3,3V24Z" opacity=".15"></path><path d="M3.472,16l12.528,8,12.528-8-12.528-8L3.472,16Z" fill="#fedf00"></path><circle cx="16" cy="16" r="5" fill="#0a2172"></circle><path d="M14,14.5c-.997,0-1.958,.149-2.873,.409-.078,.35-.126,.71-.127,1.083,.944-.315,1.951-.493,2.999-.493,2.524,0,4.816,.996,6.519,2.608,.152-.326,.276-.666,.356-1.026-1.844-1.604-4.245-2.583-6.875-2.583Z" fill="#fff"></path><path d="M27,5H5c-1.657,0-3,1.343-3,3v1c0-1.657,1.343-3,3-3H27c1.657,0,3,1.343,3,3v-1c0-1.657-1.343-3-3-3Z" fill="#fff" opacity=".2"></path></svg>
                                        </div>
                                        <select id="whatsapp-ddi" class="w-36 p-3 border ddi-select">
                                            <option data-ddi="55" value="BR" selected>+55 (Brasil)</option>
                                        </select>
                                    </div>
                                    <input type="text" id="whatsapp-number" required class="w-full p-3 border rounded-r-md">
                                </div>
                            </div>
                            <div>
<div class="flex items-center gap-2 mb-2">
    <img width="24" height="24" src="https://img.icons8.com/ios/24/phone--v1.png" alt="phone--v1"/>
    <label class="block text-sodieText text-lg font-medium">Telefone:</label>
</div>
                                <input type="text" id="footer-phone" class="w-full p-3 border rounded-md">
                            </div>
                            <div>
<div class="flex items-center gap-2 mb-2">
<img width="24" height="24" src="https://img.icons8.com/ios/24/mail.png" alt="mail"/>
    <label class="block text-sodieText text-lg font-medium">Email:</label>
</div>
                                <input type="email" id="footer-email" class="w-full p-3 border rounded-md">
                            </div>
                            
                                <!-- MAPA ENDEREÇO -->
                                <div class="accordion-item space-y-4">
                               
                                    <button type="button" class="accordion-header">
    <div class="flex items-center gap-3">
        <img width="24" height="24" src="https://img.icons8.com/material-rounded/24/address.png" alt="address"/>
        <span class="text-lg font-medium text-sodieText">Endereço da Loja</span>
    </div>
    <svg class="accordion-icon w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
</button>
                                
                                <div class="accordion-content">
                                    <div class="accordion-content-inner space-y-4">
                                
<div>
    <label for="gmaps-query-address" class="block text-sm font-medium text-gray-700">Nome/Endereço para o Google Maps:</label>
    <input type="text" id="gmaps-query-address" placeholder="Ex: Magias da Naty" class="w-full p-2 border rounded-md mt-1">
    <p class="text-xs text-gray-500 mt-1">Use o nome exato da sua loja como cadastrado no Google Maps para maior precisão.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="footer-address-street" class="block text-sm font-medium text-gray-700">Rua/Avenida:</label>
                                        <input type="text" id="footer-address-street" class="w-full p-2 border rounded-md mt-1">
                                    </div>
                                    <div>
                                        <label for="footer-address-number" class="block text-sm font-medium text-gray-700">Número:</label>
                                        <input type="text" id="footer-address-number" class="w-full p-2 border rounded-md mt-1">
                                    </div>
                                </div>
                                <div>
                                    <label for="footer-address-neighborhood" class="block text-sm font-medium text-gray-700">Bairro:</label>
                                    <input type="text" id="footer-address-neighborhood" class="w-full p-2 border rounded-md mt-1">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-4">
                                    <div>
                                        <label for="footer-address-city" class="block text-sm font-medium text-gray-700">Cidade:</label>
                                        <input type="text" id="footer-address-city" class="w-full p-2 border rounded-md mt-1">
                                    </div>
                                    <div>
                                        <label for="footer-address-state" class="block text-sm font-medium text-gray-700">Estado (UF):</label>
                                        <input type="text" id="footer-address-state" class="w-full p-2 border rounded-md mt-1" maxlength="2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                

                            <!-- Gaveta: Horário de Atendimento -->
                            <div class="accordion-item space-y-4">
                                <button type="button" class="accordion-header">
    <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 24 24">
<path d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z M 11 6 L 11 12.414062 L 15.292969 16.707031 L 16.707031 15.292969 L 13 11.585938 L 13 6 L 11 6 z"></path>
</svg>
        <span class="text-lg font-medium text-sodieText">Horário de atendimento</span>
    </div>
    <svg class="accordion-icon w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
</button>
                                <div class="accordion-content">
                                    <div class="accordion-content-inner space-y-4">
                                <div id="hours-applicator" class="hours-applicator">
    <p class="font-semibold mb-2 text-sm">Aplicar horário em lote:</p>
    <div class="applicator-days">
        <label><input type="checkbox" id="select-all-days"> Todos os dias</label>
        <label><input type="checkbox" id="select-weekdays"> Dias úteis</label>
        <label><input type="checkbox" id="select-weekends"> Fim de semana</label>
    </div>
    <div class="flex items-center flex-wrap pb-4 gap-4">
        <div class="flex items-center gap-2">
            <label for="applicator-start-time" class="text-sm">De:</label>
            <input type="time" id="applicator-start-time" class="p-2 border rounded-md w-32">
        </div>
        <div class="flex items-center gap-2">
            <label for="applicator-end-time" class="text-sm">Até:</label>
            <input type="time" id="applicator-end-time" class="p-2 border rounded-md w-32">
        </div>
        <button type="button" id="apply-batch-hours-btn" class="bg-sodiePrimary text-sodieLightText px-4 py-2 rounded-md font-semibold text-sm">Aplicar</button>
    </div>
    <div id="hours-selector" class="space-y-3"></div>
</div>
</div>
</div>
</div>

                            <!-- Gaveta: Redes Sociais e Email -->
                            <div class="accordion-item space-y-4">
                                <button type="button" class="accordion-header">
    <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="w-6 h-6">
            <path d="M2.424,17.977l.068-10.18c.012-1.843,1.301-3.423,3.08-3.775l9.831-1.949c2.362-.468,4.555,1.38,4.539,3.827l-.068,10.182c-.013,1.842-1.302,3.421-3.081,3.774l-9.831,1.949c-2.362,.468-4.555-1.38-4.539-3.828Z" opacity=".2"></path>
            <path d="M7.241,22.039l.068-10.182c.011-1.841,1.301-3.42,3.08-3.773l9.831-1.948c2.362-.468,4.555,1.38,4.539,3.827l-.068,10.182c-.012,1.842-1.301,3.421-3.08,3.774l-9.831,1.949c-2.362,.468-4.555-1.38-4.539-3.827v-.002Z" opacity=".5"></path>
            <path d="M12.058,26.1l.068-10.182c.012-1.843,1.301-3.421,3.08-3.774l9.831-1.949c2.362-.468,4.555,1.38,4.539,3.827l-.068,10.182c-.012,1.843-1.301,3.422-3.08,3.774l-9.831,1.949c-2.362,.468-4.555-1.38-4.539-3.827h0Z" opacity=".8"></path>
        </svg>
        <span class="text-lg font-medium text-sodieText">Redes Sociais</span>
    </div>
    <svg class="accordion-icon w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
</button>
                                <div class="accordion-content">
                                    <div class="accordion-content-inner space-y-4">
                                        
                                        <!-- Instagram -->
                                        <div class="p-4 border rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="block text-sodieText text-lg font-medium">Instagram</label>
                                                <label class="switch"><input type="checkbox" id="instagram-active"><span class="slider"></span></label>
                                            </div>
                                            <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                                                <span class="px-3 text-gray-500 bg-gray-100 border-r">instagram.com/</span>
                                                <input type="text" id="footer-instagram" placeholder="seu-usuario" class="w-full p-3 border-none focus:ring-0">
                                            </div>
                                        </div>
                                        <!-- Facebook -->
                                        <div class="p-4 border rounded-lg">
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="block text-sodieText text-lg font-medium">Facebook</label>
                                                <label class="switch"><input type="checkbox" id="facebook-active"><span class="slider"></span></label>
                                            </div>
                                            <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                                                <span class="px-3 text-gray-500 bg-gray-100 border-r">facebook.com/</span>
                                                <input type="text" id="footer-facebook" placeholder="sua-pagina" class="w-full p-3 border-none focus:ring-0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end pt-4">
                                <button type="submit" id="save-contact-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full font-semibold">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="banner-content" class="settings-content hidden">
                    <div class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
                        <h2 class="text-3xl font-semibold font-heading text-sodieText mb-6 flex gap-3">
                            <span>Gerenciamento de Banner</span>
                            <svg class="w-8 h-8 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM4 9h16"></path></svg>
                        </h2>
                        <p class="text-gray-600 mb-6">Adicione, remova ou arraste para reordenar as imagens do banner. O limite é de 6 imagens.</p>
                        
                        <form id="banner-form">
                            <div>
                                <label class="block text-sodieText text-lg font-medium mb-2">Adicionar Novas Imagens:</label>
                                <div id="banner-upload-wrapper" class="file-upload-wrapper flex flex-col items-center justify-center">
                                    <svg class="w-12 h-12 text-gray-400 mb-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p>Clique para adicionar imagens (máx. 6)</p>
                                    <input type="file" id="banner-files-add" accept="image/*" class="hidden" multiple>
                                </div>
                                <div id="banner-new-previews" class="image-preview-container"></div>
                            </div>
                            <div class="flex justify-end mt-4">
                                <button type="submit" id="save-banners-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full font-semibold">Enviar Banners</button>
                            </div>
                        </form>

                        <hr class="my-6">

                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-semibold text-sodieText">Banners Atuais</h3>
                                <button id="save-banner-order-btn" class="hidden bg-blue-600 text-white px-4 py-2 rounded-full font-semibold text-sm hover:bg-blue-700 transition-all">Salvar Ordem</button>
                            </div>
                            <p id="loading-banners-message" class="text-center text-gray-500">Carregando banners...</p>
                            <div id="banner-preview-list" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <!-- Previews dos banners serão inseridos aqui -->
                            </div>
                        </div>
                    </div>
                </div>
                
                 <div id="colors-content" class="settings-content hidden">
                    <div class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
                        <h2 class="text-3xl font-semibold font-heading text-sodieText mb-6 flex gap-3">
                            <span>Gerenciamento de Cores</span>
<svg width="40" height="40" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path d="M104.182 39.193h-1.466v-7.217A16.735 16.735 0 0 0 86 15.26h-6.169a5.477 5.477 0 0 0-5.267-4.01H53.437a5.477 5.477 0 0 0-5.267 4.01H42a16.735 16.735 0 0 0-16.716 16.716v7.218h-1.466a1.75 1.75 0 0 0-1.75 1.75v6.433a1.75 1.75 0 0 0 1.75 1.75H28.5v60.36c0 2.644 3.4 4.326 11.353 5.626A157.65 157.65 0 0 0 64 116.75a157.65 157.65 0 0 0 24.146-1.638c7.957-1.3 11.353-2.982 11.353-5.626v-60.36h4.683a1.75 1.75 0 0 0 1.75-1.75v-6.433a1.75 1.75 0 0 0-1.75-1.75zM32 39.108a37.508 37.508 0 0 0 7.853 1.948c3.517.575 7.671 1 12.182 1.279 1.961 2.847 5.635 5.682 12.431 5.311v16.483H32zm35.967 6.642a1.822 1.822 0 0 0-.633-1.347 1.745 1.745 0 0 0-1.372-.411c-3.667.482-6.575-.006-8.73-1.41 2.206.072 4.47.11 6.769.11a157.65 157.65 0 0 0 24.146-1.638 41.46 41.46 0 0 0 7.207-1.7 7.194 7.194 0 0 1-.145 6.177 6.688 6.688 0 0 1-6.021 4.08 12.5 12.5 0 0 1-5.818-1.474 7.358 7.358 0 0 0-7.16.381 7.271 7.271 0 0 0-3.425 6.2v23.005a2.409 2.409 0 0 1-2.541 2.406 2.57 2.57 0 0 1-2.277-2.641zm8.318 8.966a3.743 3.743 0 0 1 1.784-3.231 3.88 3.88 0 0 1 3.775-.2 15.941 15.941 0 0 0 7.344 1.823A9.826 9.826 0 0 0 96 50.305v13.824H76.285zm19.28-19.238a1.741 1.741 0 0 0-.588.3C91.386 37.365 80.115 39.193 64 39.193c-17.308 0-29.038-2.109-31.656-3.763 2.618-1.655 14.348-3.763 31.656-3.763s29.038 2.109 31.656 3.764c-.025.015-.064.031-.091.047zM32 67.629h32.467v9.858a6.033 6.033 0 0 0 5.594 6.136c.107.006.214.008.32.008a5.854 5.854 0 0 0 4.063-1.623 5.934 5.934 0 0 0 1.842-4.287V67.629H96v18.638H32zm19.465-50.907a1.974 1.974 0 0 1 1.972-1.972h21.126a1.974 1.974 0 0 1 1.972 1.972v.578a1.974 1.974 0 0 1-1.972 1.971H53.437a1.974 1.974 0 0 1-1.972-1.971zM42 18.76h6.169a5.477 5.477 0 0 0 5.267 4.01h21.127a5.477 5.477 0 0 0 5.268-4.01H86a13.231 13.231 0 0 1 13.216 13.216v2.244c-.949-1.966-4.4-3.326-11.069-4.415A157.65 157.65 0 0 0 64 28.167 157.65 157.65 0 0 0 39.854 29.8c-6.666 1.089-10.121 2.449-11.069 4.415v-2.239A13.231 13.231 0 0 1 42 18.76zM25.568 45.626v-2.933H28.5v2.933zM64 113.25c-18.239 0-30.285-2.342-32-4.026V89.767h64v19.457c-1.715 1.684-13.761 4.026-32 4.026zm38.432-67.624H99.5v-2.933h2.933z"/></svg>
                        </h2>
                        <p class="text-gray-600 mb-6">Altere as cores primária e secundária do site.</p>
                        
                        <form id="colors-form" class="space-y-6 text-left">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Cor Primária -->
                                <div>
                                    <label for="primary-color-picker" class="block text-sodieText text-lg font-medium mb-2">Cor Primária:</label>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="primary-color-picker">
                                        <input type="text" id="primary-color-hex" class="w-full p-2 border rounded-md" placeholder="#6E1C44">
                                    </div>
                                </div>
                                <!-- Cor de Destaque (sodieAccent) -->
                                <div>
                                    <label for="accent-color-picker" class="block text-sodieText text-lg font-medium mb-2">Cor Secundária:</label>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="accent-color-picker">
                                        <input type="text" id="accent-color-hex" class="w-full p-2 border rounded-md" placeholder="#F3C555">
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end pt-4">
                                <button type="submit" id="save-colors-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full font-semibold">Aplicar Cores</button>
                            </div>
                        </form>

                        <div id="color-preview-panel" class="mt-8 border-t pt-6">
    <h4 class="text-xl font-semibold text-sodieText mb-4 text-center">Pré-visualização</h4>
    
    <div class="preview-flex-container">

        <div class="preview-item-wrapper">
            <p class="preview-item-label">Texto</p>
            <div class="preview-text-box">
                <h3 class="preview-text-heading">Título com Cor Primária</h3>
                <p class="preview-text-body">Este é um texto comum. A cor principal é aplicada em elementos de destaque como títulos ou preços.</p>
            </div>
        </div>

        <div class="preview-item-wrapper">
            <p class="preview-item-label">Botões</p>
            <div class="preview-button-box">
    <button class="preview-button">Passe o mouse ou toque aqui</button>
    <button class="preview-cart-button" title="Botão de Carrinho">
        <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h1.5L8 16m0 0h8m-8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm.75-3H7.5M11 7H6.312M17 4v6m-3-3h6"/>
        </svg>
    </button>

    <p class="preview-text-body mt-4">
        A <strong>Cor Secundária</strong> é usada no efeito (ao passar o mouse) para dar feedback visual ao usuário.
    </p>
</div>
        </div>

    </div>
</div>

                        </div>
                </div>
                    </div>
                </div>


            </div>

            <!-- Secção 2: Gerenciar Categorias -->
            <div id="categories-section" class="crud-section hidden">
                <div class="bg-white p-8 rounded-lg shadow-lg max-w-2xl mx-auto">
<h2 class="text-3xl font-semibold font-heading text-sodieText mb-6 flex gap-3">
                            <span>Gerenciamento de Categorias</span>
<svg class="w-8 h-8 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        </h2>
                    <form id="category-add-form" class="mb-6 grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-4 items-end">
                        <div>
                            <label for="category-name-add" class="block text-sm font-medium text-gray-700 mb-1">Nova Categoria:</label>
                            <input type="text" id="category-name-add" placeholder="Nome da nova categoria" required class="w-full p-3 border border-gray-300 rounded-md">
                        </div>
                        <div class="flex">
                            <button type="submit" id="save-category-add-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-3 rounded-full font-semibold w-full" disabled>
                                + Adicionar
                            </button>
                        </div>
                    </form>
                    <hr class="my-6">
                    <div id="categories-list" class="space-y-3">
                        <p id="loading-categories-message" class="text-center text-gray-500">Carregando categorias...</p>
                    </div>
                </div>
            </div>

             <!-- Secção 3: Gerenciar Produtos -->
            <div id="products-section" class="crud-section hidden">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
<h2 class="text-3xl font-semibold font-heading text-sodieText mb-6 flex gap-3">
                            <span>Gerenciamento de Produtos</span>
<svg class="w-8 h-8 text-sodiePrimary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        </h2>
                        
                        <button id="add-product-btn" class="bg-sodiePrimary text-sodieLightText px-6 py-2 rounded-full hover:bg-sodieAccent hover:text-sodieText transition duration-300 font-semibold w-full md:w-auto">
                            + Novo Produto
                        </button>
                    </div>
                    
                    <div id="category-filters-crud" class="flex flex-wrap justify-start gap-2 my-4 border-b pb-4">
                        <!-- Botões de filtro de categoria entram aqui -->
                         
                    </div>
                    <div class="w-full md:w-96">
                            <input type="search" id="product-search-input" placeholder="Buscar por nome do produto..." class="w-full p-2 border border-gray-300 rounded-full focus:ring-sodiePrimary focus:border-sodiePrimary">
                        </div>
                    
                    <p id="loading-message" class="col-span-full text-center text-gray-500">Carregando produtos...</p>
                    <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4">
                        <!-- A lista de produtos será inserida aqui -->
                    </div>
                </div>
            </div>

        </div>
    </main>


    </div>

    <!-- Modais de Edição -->
    <div id="edit-category-modal" class="modal">
        <!-- O conteúdo será preenchido via JS -->
    </div>
    <div id="product-modal" class="modal">
        <!-- O conteúdo será preenchido via JS -->
    </div>
    
    <div id="custom-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <p id="modal-message" class="mb-6"></p>
            <div id="modal-actions" class="flex justify-center space-x-4">
                <button id="modal-confirm-btn" class="bg-red-500 text-white px-6 py-2 rounded-full hover:bg-red-600 transition duration-300 hidden">Confirmar</button>
                <button id="modal-cancel-btn" class="bg-gray-300 text-sodieText px-6 py-3 rounded-full hover:bg-gray-400 transition duration-300 hidden">Cancelar</button>
                <button id="modal-ok-btn" class="bg-sodiePrimary text-white px-6 py-2 rounded-full hover:bg-sodieAccent transition duration-300 hidden">OK</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, doc, updateDoc, deleteDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        import { firebaseConfig, ADMIN_UID, IMGBB_API_KEY } from './config.js';

        const appId = firebaseConfig.appId;
        const DEFAULT_FAVICON_URL = "https://i.ibb.co/DH228SHL/favicon-32x32.png"; // <-- ADICIONE AQUI
let unsubscribeFavicons = null; // <-- ADICIONE ESTA LINHA

        const previewPanel = document.getElementById('color-preview-panel');

// ADICIONE A FUNÇÃO ABAIXO
        function capitalizeWords(str) {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

                // --- Adicione estas constantes perto das outras ---
        const colorsForm = document.getElementById('colors-form');
        const primaryColorPicker = document.getElementById('primary-color-picker');
        const primaryColorHex = document.getElementById('primary-color-hex');
        const accentColorPicker = document.getElementById('accent-color-picker');
        const accentColorHex = document.getElementById('accent-color-hex');


        // --- Adicione estas novas funções ---
        function getSiteColors() {
            if (!db) return;
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            getDoc(configRef).then(snapshot => {
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    const primary = data.primaryColor || '#6E1C44';
                    const accent = data.accentColor || '#F3C555'; // Alvo é accentColor
                    primaryColorPicker.value = primary;
                    primaryColorHex.value = primary;
                    accentColorPicker.value = accent;
                    accentColorHex.value = accent;

                    // ATUALIZAÇÃO: Define as cores iniciais na pré-visualização
        if (previewPanel) {
            previewPanel.style.setProperty('--preview-color-primary', primary);
            previewPanel.style.setProperty('--preview-color-accent', accent);
                        }
                }
            });
        }

        async function handleColorFormSubmit(e) {
            e.preventDefault();
            const colorsData = {
                primaryColor: primaryColorHex.value.trim(),
                accentColor: accentColorHex.value.trim(), // Salva como accentColor
            };
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            try {
                await setDoc(configRef, colorsData, { merge: true });
                showModal('Sucesso', 'Cores do site atualizadas!', 'alert');
            } catch (error) {
                showModal('Erro', `Não foi possível salvar as cores: ${error.message}`, 'alert');
            }
        }


            
        // --- Adicione estas constantes perto das outras ---
        const instagramUrlInput = document.getElementById('footer-instagram');
        const instagramActiveToggle = document.getElementById('instagram-active');
        const facebookUrlInput = document.getElementById('footer-facebook');
        const facebookActiveToggle = document.getElementById('facebook-active');


        

            // --- Novas Constantes para o Gerenciador de Banner ---
        const bannerForm = document.getElementById('banner-form');
        const bannerUploadWrapper = document.getElementById('banner-upload-wrapper');
        const bannerFilesInput = document.getElementById('banner-files-add');
        const bannerPreviewList = document.getElementById('banner-preview-list');
        const bannerNewPreviews = document.getElementById('banner-new-previews');
        const loadingBannersMessage = document.getElementById('loading-banners-message');
        let newBannerFiles = [];


        const saveBannerOrderBtn = document.getElementById('save-banner-order-btn');


        // Novas Funções para o Gerenciador de Banner
        function getBanners() {
            if (!db) return;
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);

            onSnapshot(configRef, (snapshot) => {
                if(loadingBannersMessage) loadingBannersMessage.style.display = 'none';
                bannerPreviewList.innerHTML = '';
                saveBannerOrderBtn.classList.add('hidden');
                const data = snapshot.exists() ? snapshot.data() : {};
                const bannerUrls = data.bannerUrls || [];

                if (bannerUrls.length === 0) {
                    bannerPreviewList.innerHTML = '<p class="col-span-full text-center text-gray-500">Nenhum banner cadastrado.</p>';
                } else {
                    // ALTERAÇÃO: Adicionado 'index' para obter a posição
                    bannerUrls.forEach((url, index) => {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'relative group cursor-move';
                        previewItem.dataset.url = url;
                        // ALTERAÇÃO: Adicionado o div com o número da ordem
                        previewItem.innerHTML = `
                            <div class="banner-order-number">${index + 1}</div>
                            <img src="${url}" class="w-full h-32 object-cover rounded-lg shadow-md">
                            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <span class="text-white font-bold text-sm">Arraste para reordenar</span>
                            </div>
                            <button class="remove-banner-btn absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold" data-url="${url}" title="Remover">&times;</button>
                        `;
                        bannerPreviewList.appendChild(previewItem);
                    });
                }
                
                new Sortable(bannerPreviewList, {
                    animation: 150,
                    ghostClass: 'opacity-50',
                    onEnd: () => saveBannerOrderBtn.classList.remove('hidden')
                });
            });
        }

        async function handleBannerFormSubmit(e) {
            e.preventDefault();
            if (newBannerFiles.length === 0) {
                showModal('Aviso', 'Nenhuma nova imagem selecionada.', 'alert');
                return;
            }

            const saveBtn = document.getElementById('save-banners-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Enviando...';

            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);

            try {
                const configSnap = await getDoc(configRef);
                const existingUrls = configSnap.exists() ? (configSnap.data().bannerUrls || []) : [];

                if (existingUrls.length + newBannerFiles.length > 6) {
                    throw new Error(`Você só pode ter um máximo de 6 banners. Já existem ${existingUrls.length}.`);
                }

                const uploadPromises = newBannerFiles.map(file => uploadToImgbb(file));
                const newImageUrls = await Promise.all(uploadPromises);
                const finalBannerUrls = [...existingUrls, ...newImageUrls];

                await setDoc(configRef, { bannerUrls: finalBannerUrls }, { merge: true });
                
                showModal('Sucesso', 'Banners atualizados!', 'alert');
                bannerFilesInput.value = '';
                newBannerFiles = [];
                bannerNewPreviews.innerHTML = '';

            } catch (error) {
                showModal('Erro', `Não foi possível salvar os banners: ${error.message}`, 'alert');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Salvar Banners';
            }
        }

                

        async function saveBannerOrder() {
            const bannerItems = bannerPreviewList.querySelectorAll('.relative.group');
            const newOrderUrls = Array.from(bannerItems).map(item => item.dataset.url);

            saveBannerOrderBtn.disabled = true;
            saveBannerOrderBtn.textContent = 'Salvando...';

            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            try {
                await setDoc(configRef, { bannerUrls: newOrderUrls }, { merge: true });
                showModal('Sucesso', 'A nova ordem dos banners foi salva!', 'alert');
                saveBannerOrderBtn.classList.add('hidden'); // Esconde o botão após salvar
            } catch (error) {
                showModal('Erro', `Não foi possível salvar a ordem: ${error.message}`, 'alert');
            } finally {
                saveBannerOrderBtn.disabled = false;
                saveBannerOrderBtn.textContent = 'Salvar Ordem';
            }
        }


                     // --- Novas Constantes para o Gerenciador de Logo ---
        const logoAddForm = document.getElementById('logo-add-form');
        const logoList = document.getElementById('logo-list');
        const loadingLogosMessage = document.getElementById('loading-logos-message');
        const DEFAULT_LOGO_URL = "https://i.ibb.co/v45fCXT6/logo.png"; // URL do seu logo padrão
        
        // Novas constantes para o upload
        const logoUploadWrapper = document.getElementById('logo-upload-wrapper');
        const logoFileInput = document.getElementById('logo-file-add');
        const logoPreviewContainer = document.getElementById('logo-preview-container');
        let newLogoFile = null; // Variável para guardar o ficheiro selecionado
        let newFaviconFile = null;
         let currentActiveLogoUrl = ''; // <-- Adicione esta linha
        const logoUrlAddInput = document.getElementById('logo-url-add');




        // --- Adicione esta linha ---
        const productSearchInput = document.getElementById('product-search-input');


        // Adicione estas constantes
        const whatsappForm = document.getElementById('whatsapp-form');




        // --- INÍCIO DO NOVO BLOCO DE CONTATO ---
        
      // --- Lógica de Contato ---
        const contactForm = document.getElementById('contact-form');
        const whatsappDDISelect = document.getElementById('whatsapp-ddi');
        const ddiFlagContainer = document.getElementById('ddi-flag');
        const whatsappNumberInput = document.getElementById('whatsapp-number');
        const footerPhoneInput = document.getElementById('footer-phone');
        const footerEmailInput = document.getElementById('footer-email');
        const hoursSelectorContainer = document.getElementById('hours-selector');

        const FLAG_SVGS = {
            'BR': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect x="1" y="4" width="30" height="24" rx="4" ry="4" fill="#459a45"></rect><path d="M27,4H5c-2.209,0-4,1.791-4,4V24c0,2.209,1.791,4,4,4H27c2.209,0,4-1.791,4-4V8c0-2.209-1.791-4-4-4Zm3,20c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V8c0-1.654,1.346-3,3-3H27c1.654,0,3,1.346,3,3V24Z" opacity=".15"></path><path d="M3.472,16l12.528,8,12.528-8-12.528-8L3.472,16Z" fill="#fedf00"></path><circle cx="16" cy="16" r="5" fill="#0a2172"></circle><path d="M14,14.5c-.997,0-1.958,.149-2.873,.409-.078,.35-.126,.71-.127,1.083,.944-.315,1.951-.493,2.999-.493,2.524,0,4.816,.996,6.519,2.608,.152-.326,.276-.666,.356-1.026-1.844-1.604-4.245-2.583-6.875-2.583Z" fill="#fff"></path><path d="M27,5H5c-1.657,0-3,1.343-3,3v1c0-1.657,1.343-3,3-3H27c1.657,0,3,1.343,3,3v-1c0-1.657-1.343-3-3-3Z" fill="#fff" opacity=".2"></path></svg>`,
             };
        
        function applyGenericPhoneMask(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é dígito
            value = value.substring(0, 11); // Limita a 11 dígitos

            if (value.length > 10) { // Celular com 9 dígitos: (XX) XXXXX-XXXX
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (value.length > 6) { // Telefone com 8 dígitos: (XX) XXXX-XXXX
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 2) { // Apenas o DDD
                value = value.replace(/^(\d{2})(\d*)/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)/, '($1');
            }
            input.value = value;
        }
        
        function renderHoursSelector() {
            const days = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
            hoursSelectorContainer.innerHTML = days.map(day => `
                <div class="day-selector">
                    <label class="day-selector-label">
                        <input type="checkbox" data-day="${day}">
                        <span>${day}</span>
                    </label>
                    <div class="time-inputs">
                        <input type="time" data-day="${day}" data-type="start" class="p-2 border rounded-md" disabled>
                        <span>até</span>
                        <input type="time" data-day="${day}" data-type="end" class="p-2 border rounded-md" disabled>
                    </div>
                </div>
            `).join('');
        }


        


        function getContactInfo() {
            if (!db) return;
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            getDoc(configRef).then(snapshot => {
                if (snapshot.exists()) {
                    const data = snapshot.data();

                    // ADICIONE ESTE BLOCO PARA PREENCHER O ENDEREÇO
            if (data.address) {
                document.getElementById('gmaps-query-address').value = data.gmapsQuery || '';
                document.getElementById('footer-address-street').value = data.address.street || '';
                document.getElementById('footer-address-number').value = data.address.number || '';
                document.getElementById('footer-address-neighborhood').value = data.address.neighborhood || '';
                document.getElementById('footer-address-city').value = data.address.city || '';
                document.getElementById('footer-address-state').value = data.address.state || '';
            }


                    // Preenche os campos de redes sociais, extraindo o nome de utilizador
                    if (data.instagramUrl) {
                        const urlParts = data.instagramUrl.split('/');
                        instagramUrlInput.value = urlParts.pop() || urlParts.pop(); // Pega o último segmento não vazio
                    } else {
                        instagramUrlInput.value = '';
                    }
                    instagramActiveToggle.checked = data.instagramActive === true;

                    if (data.facebookUrl) {
                        const urlParts = data.facebookUrl.split('/');
                        facebookUrlInput.value = urlParts.pop() || urlParts.pop();
                    } else {
                        facebookUrlInput.value = '';
                    }
                    facebookActiveToggle.checked = data.facebookActive === true;
                


                    footerPhoneInput.value = data.footerPhone || '';
                    if(data.footerPhone) applyGenericPhoneMask(footerPhoneInput);
                    footerEmailInput.value = data.footerEmail || '';
                    if (data.footerHours) {
                        try {
                            JSON.parse(data.footerHours).forEach(item => {
                                const dayCheckbox = hoursSelectorContainer.querySelector(`input[type="checkbox"][data-day="${item.day}"]`);
                                const startTimeInput = hoursSelectorContainer.querySelector(`input[type="time"][data-day="${item.day}"][data-type="start"]`);
                                const endTimeInput = hoursSelectorContainer.querySelector(`input[type="time"][data-day="${item.day}"][data-type="end"]`);
                                if (dayCheckbox) dayCheckbox.checked = true;
                                if (startTimeInput) startTimeInput.value = item.start;
                                if (endTimeInput) endTimeInput.value = item.end;
                                
                                const timeInputs = hoursSelectorContainer.querySelectorAll(`input[type="time"][data-day="${item.day}"]`);
                                timeInputs.forEach(input => input.disabled = !dayCheckbox.checked);
                            });
                        } catch (e) { console.error("Erro ao carregar horário:", e); }
                    }
                    if (data.whatsappNumber) {
                        const fullNumber = data.whatsappNumber;
                        const option = Array.from(whatsappDDISelect.options).find(opt => fullNumber.startsWith(opt.dataset.ddi));
                        if (option) {
                            whatsappDDISelect.value = option.value;
                            const numberWithoutDDI = fullNumber.substring(option.dataset.ddi.length);
                            whatsappNumberInput.value = numberWithoutDDI;
                            
                            // --- ALTERAÇÃO AQUI ---
                            if (option.value === 'BR') {
                                applyGenericPhoneMask(whatsappNumberInput);
                            }
                            ddiFlagContainer.innerHTML = FLAG_SVGS[option.value] || '';
                        } else {
                            whatsappNumberInput.value = fullNumber;
                        }
                    }
                }
            });
        }

        
        async function handleContactFormSubmit(e) {
            e.preventDefault();
            const selectedOption = whatsappDDISelect.options[whatsappDDISelect.selectedIndex];
            const ddi = selectedOption.dataset.ddi;
            const numberOnly = whatsappNumberInput.value.replace(/\D/g, '');


            

            if (!numberOnly) {
                showModal('Erro', 'Por favor, insira um número de WhatsApp.', 'alert');
                return;
            }

            // Captura e VALIDA os dados do horário de atendimento
            const hoursData = [];
            let isHoursValid = true;
            hoursSelectorContainer.querySelectorAll('.day-selector').forEach(dayEl => {
                const checkbox = dayEl.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    const day = checkbox.dataset.day;
                    const start = dayEl.querySelector('input[data-type="start"]').value;
                    const end = dayEl.querySelector('input[data-type="end"]').value;
                    if (!start || !end) {
                        isHoursValid = false; // Marca como inválido se o horário estiver incompleto
                    }
                    hoursData.push({ day, start, end });
                }
            });

            // Se a validação falhar, exibe o modal e interrompe o envio
            if (!isHoursValid) {
                showModal('Erro de Validação', 'Para cada dia da semana selecionado, é obrigatório preencher o horário de início e fim.', 'alert');
                return;
            }


            // Monta as URLs completas a partir dos nomes de utilizador
            const instagramUsername = instagramUrlInput.value.trim();
            const facebookUsername = facebookUrlInput.value.trim();

            

            const contactData = {
                whatsappNumber: ddi + numberOnly,
                footerPhone: footerPhoneInput.value.trim(),
                footerEmail: footerEmailInput.value.trim(),
                footerHours: JSON.stringify(hoursData),
                instagramUrl: instagramUsername ? `https://instagram.com/${instagramUsername}` : '',
                instagramActive: instagramActiveToggle.checked,
                facebookUrl: facebookUsername ? `https://facebook.com/${facebookUsername}` : '',
                facebookActive: facebookActiveToggle.checked,
                gmapsQuery: document.getElementById('gmaps-query-address').value.trim(),
                address: {
            street: capitalizeWords(document.getElementById('footer-address-street').value.trim()),
            number: document.getElementById('footer-address-number').value.trim(),
            neighborhood: capitalizeWords(document.getElementById('footer-address-neighborhood').value.trim()),
            city: capitalizeWords(document.getElementById('footer-address-city').value.trim()),
            state: document.getElementById('footer-address-state').value.trim().toUpperCase()
        }
            };

            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            try {
                await setDoc(configRef, contactData, { merge: true });
                showModal('Sucesso', 'Informações de contato atualizadas!', 'alert');
            } catch (error) {
                showModal('Erro', `Não foi possível atualizar as informações: ${error.message}`, 'alert');
            }
        }
        
        // Adicione os listeners para o formulário de contato dentro de window.onload
        
        // --- FIM DO NOVO BLOCO DE CONTATO ---




        
        


                // --- Função para Carregar Configurações do Site (incluindo o logo) ---
        function loadSiteSettings() {
            if (!db) return;
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
            const dynamicColorsStyle = document.getElementById('dynamic-colors'); 
            const DEFAULT_LOGO_URL = "https://i.ibb.co/v45fCXT6/logo.png";
            const DEFAULT_BANNER_URLS = [
                "https://images.unsplash.com/photo-1567667778212-35e297340433?q=80&w=1974&auto=format&fit=crop",
                "https://images.unsplash.com/photo-1578985545062-69928b1d9587?q=80&w=1989&auto=format&fit=crop",
                "https://images.unsplash.com/photo-1588195538326-c2bfa1e79cd8?q=80&w=2070&auto=format&fit=crop"
            ];

            onSnapshot(configRef, (snapshot) => {
                const data = snapshot.exists() ? snapshot.data() : {};
                

                const faviconLink = document.getElementById('favicon-link'); // Pega o link do favicon

        // ADICIONE ESTA VERIFICAÇÃO
        if (faviconLink && data.faviconUrl) {
            faviconLink.href = data.faviconUrl;
        }

                    // --- NOVA LÓGICA PARA REDES SOCIAIS ---
                const facebookLink = document.getElementById('footer-facebook-link');
                const instagramLink = document.getElementById('footer-instagram-link');

                if (facebookLink) {
                    if (data.facebookActive && data.facebookUrl) {
                        facebookLink.href = data.facebookUrl;
                        facebookLink.classList.remove('hidden');
                    } else {
                        facebookLink.classList.add('hidden');
                    }
                }

                if (instagramLink) {
                    if (data.instagramActive && data.instagramUrl) {
                        instagramLink.href = data.instagramUrl;
                        instagramLink.classList.remove('hidden');
                    } else {
                        instagramLink.classList.add('hidden');
                    }
                }


                
                // 1. Aplica as Cores Dinâmicas
                const primaryColor = data.primaryColor || '#6E1C44';
                const accentColor = data.accentColor || '#F3C555'; // Lê accentColor
                if (dynamicColorsStyle) {
                    dynamicColorsStyle.innerHTML = `
                        :root {
                            --color-primary: ${primaryColor};
                            --color-accent: ${accentColor};
                        }
                    `;
                }


                // Atualiza o Logo
                const logoUrl = data.activeLogoUrl || DEFAULT_LOGO_URL;
                document.querySelectorAll('.site-logo').forEach(img => {
                    if (img.src !== logoUrl) img.src = logoUrl;
                });

                // Atualiza a variável global de banners e renderiza o carrossel
                heroCarouselImages = (data.bannerUrls && data.bannerUrls.length > 0) ? data.bannerUrls : DEFAULT_BANNER_URLS;
                renderHeroCarousel(heroCarouselImages); 

                // Atualiza o número do WhatsApp
                siteWhatsappNumber = data.whatsappNumber || siteWhatsappNumber;

                // Atualiza as informações de texto do rodapé
                const footerPhoneEl = document.getElementById('footer-phone');
                const footerEmailEl = document.getElementById('footer-email');
                const footerHoursEl = document.getElementById('footer-hours');

                if (footerPhoneEl) footerPhoneEl.textContent = data.footerPhone ? `Telefone: ${data.footerPhone}` : '';
                if (footerEmailEl) footerEmailEl.textContent = data.footerEmail ? `Email: ${data.footerEmail}` : '';
                
                // Lógica para formatar e exibir o horário
                if (footerHoursEl) {
                    let hoursText = ''; // Padrão
                    if (data.footerHours) {
                        try {
                            const hoursData = JSON.parse(data.footerHours);
                            if (hoursData.length > 0) {
                                // Exemplo de formatação: Seg: 09:00-18:00 / Ter: 09:00-18:00
                                hoursText = "Horário: " + hoursData.map(h => `${h.day.substring(0,3)}: ${h.start}-${h.end}`).join(' / ');
                            }
                        } catch(e) {
                            // Se o formato for texto simples (legado), exibe-o diretamente
                            hoursText = `Horário: ${data.footerHours}`;
                        }
                    }
                    footerHoursEl.textContent = hoursText;
                }
            });
        }
        

        




            async function deleteProduct(id) {
            if (!userId) { showModal('Erro', 'Não autenticado.', 'alert'); return; }
            try {
                const productRef = doc(db, `artifacts/${appId}/public_products`, id);
                await deleteDoc(productRef);
                showModal('Sucesso', 'Produto removido.', 'alert');
            } catch (error) {
                showModal('Erro', `Não foi possível remover o produto: ${error.message}`, 'alert');
            }
        }


            async function deleteCategory(id) {
            if (!userId) { showModal('Erro', 'Não autenticado.', 'alert'); return; }
            try {
                const categoryRef = doc(db, `artifacts/${appId}/public_categories`, id);
                await deleteDoc(categoryRef);
                showModal('Sucesso', 'Categoria removida.', 'alert');
            } catch (error) {
                showModal('Erro', `Não foi possível remover a categoria: ${error.message}`, 'alert');
            }
        }


           // --- Substitua a sua função getProducts por esta nova lógica ---

        function applyFilters() {
            const selectedCategory = categoryFiltersCrudContainer.querySelector('.active')?.dataset.category || 'Todos';
            const searchTerm = productSearchInput.value.toLowerCase();

            let filteredProducts = allProducts;

            // 1. Filtra por categoria
            if (selectedCategory !== 'Todos') {
                filteredProducts = filteredProducts.filter(product => product.category === selectedCategory);
            }

            // 2. Filtra pelo termo de busca
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => product.name.toLowerCase().includes(searchTerm));
            }

            displayProducts(filteredProducts);
        }

        function getProducts() {
            if (!db) return;
            const q = query(collection(db, `artifacts/${appId}/public_products`)); 
            onSnapshot(q, (snapshot) => {
                loadingMessage.style.display = 'none';
                allProducts = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
                
                // Aplica os filtros assim que os produtos são carregados
                applyFilters();

            }, (error) => {
                showModal('Erro', `Não foi possível carregar produtos: ${error.message}`, 'alert');
                loadingMessage.style.display = 'none';
            });
        }




        // --- Referências ao DOM ---
        const loginScreen = document.getElementById('login-screen');
        const crudContent = document.getElementById('crud-content');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutBtn = document.getElementById('logout-btn');
        const categoryAddForm = document.getElementById('category-add-form');
        const categoryNameAddInput = document.getElementById('category-name-add');
        const saveCategoryAddBtn = document.getElementById('save-category-add-btn');
        const addProductBtn = document.getElementById('add-product-btn');
        const categoriesList = document.getElementById('categories-list');
        const loadingCategoriesMessage = document.getElementById('loading-categories-message');
        const noCategoriesMessage = document.getElementById('no-categories-message');
        const productsList = document.getElementById('products-list');
        const loadingMessage = document.getElementById('loading-message');
        const noProductsMessage = document.getElementById('no-products-message');
        const editCategoryModal = document.getElementById('edit-category-modal');
        const productModal = document.getElementById('product-modal');

       const categoryFiltersCrudContainer = document.getElementById('category-filters-crud');
        let allProducts = []; // Armazena todos os produtos para filtrar localmente
        
        
        // --- Elementos do Cabeçalho ---
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminGearBtn = document.getElementById('admin-gear-btn');
        const mobileAdminGearLi = document.getElementById('mobile-admin-gear-li');

        let db, auth, userId; 
        let isDataLoaded = false;
        let newFilesToUploadEdit = [];
        let existingImageUrlsEdit = [];
        let availableCategoriesForDropdown = [];

        // --- Funções do Modal Customizado ---
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        


            let currentActiveFaviconUrl = ''; // Variável global para o favicon ativo

// Função principal que busca e renderiza a lista de favicons
function getFavicons() {
        if (!db) return;
        const faviconsQuery = query(collection(db, `artifacts/${appId}/public/data/favicons`));
        const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);

        // Listener para a configuração (qual favicon está ativo)
        onSnapshot(configRef, (configSnap) => {
            currentActiveFaviconUrl = configSnap.exists() ? configSnap.data().faviconUrl : DEFAULT_FAVICON_URL;

            // Listener para a lista de favicons (quais existem)
            // Este listener é ativado sempre que a lista de favicons no banco de dados muda.
            onSnapshot(faviconsQuery, (faviconsSnapshot) => {
                const loadingMsg = document.getElementById('loading-favicons-message');
                const listContainer = document.getElementById('favicon-list');
                if (loadingMsg) loadingMsg.style.display = 'none';
                if (listContainer) listContainer.innerHTML = '';

                // Renderiza o item padrão
                renderFaviconItem({
                    id: 'default',
                    name: 'Favicon Padrão',
                    url: DEFAULT_FAVICON_URL,
                    isDefault: true
                }, currentActiveFaviconUrl);

                // Renderiza os itens do banco de dados
                faviconsSnapshot.forEach((faviconDoc) => {
                    renderFaviconItem({ id: faviconDoc.id, ...faviconDoc.data() }, currentActiveFaviconUrl);
                });
            });
        });
    }

// Função que desenha um item na lista de favicons
function renderFaviconItem(favicon, activeFaviconUrl) {
        const isActive = favicon.url === activeFaviconUrl;
        const listContainer = document.getElementById('favicon-list');
        const itemDiv = document.createElement('div');
        itemDiv.className = `p-3 rounded-lg flex items-center justify-between ${isActive ? 'bg-gray-200 border border-gray-400' : 'bg-gray-100'}`;
        
        itemDiv.innerHTML = `
            <div class="flex items-center gap-4">
                <img src="${favicon.url}" alt="Favicon" class="h-10 w-auto bg-gray-300 p-1 rounded">
                <span class="font-medium truncate">${favicon.name}</span>
            </div>
            <div class="flex items-center gap-3">
                <label class="switch">
                    <input type="checkbox" class="select-favicon-toggle" data-url="${favicon.url}" ${isActive ? 'checked' : ''}>
                    <span class="slider"></span>
                </label>
                ${!favicon.isDefault ? `
                <button class="edit-favicon-name-btn text-blue-500 hover:text-blue-700" data-id="${favicon.id}" data-name="${favicon.name}" title="Editar Nome">
                    <svg class="w-5 h-5 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                </button>
                <button class="delete-favicon-btn text-red-500 hover:text-red-700" data-id="${favicon.id}" data-url="${favicon.url}" title="Remover">
                    <svg class="w-5 h-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
                ` : ''}
            </div>
        `;
        if (listContainer) listContainer.appendChild(itemDiv);
    }



        // --- Novas Funções para o Gerenciador de Logo ---

        // Busca e exibe os logos
        function getLogos() {
            if (!db) return;
            const logosQuery = query(collection(db, `artifacts/${appId}/public/data/logos`));
            const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);

            onSnapshot(configRef, (configSnap) => {
                currentActiveLogoUrl = configSnap.exists() ? configSnap.data().activeLogoUrl : DEFAULT_LOGO_URL;

                onSnapshot(logosQuery, (logosSnapshot) => {
                    loadingLogosMessage.style.display = 'none';
                    logoList.innerHTML = '';
                    
                    renderLogoItem({ id: 'default', name: 'Logo Padrão', url: DEFAULT_LOGO_URL, isDefault: true }, currentActiveLogoUrl);

                    logosSnapshot.forEach((logoDoc) => {
                        renderLogoItem({ id: logoDoc.id, ...logoDoc.data() }, currentActiveLogoUrl);
                    });
                });
            });
        }




        // Renderiza um item na lista de logos
        function renderLogoItem(logo, activeLogoUrl) {
            const isActive = logo.url === activeLogoUrl;
            const logoItem = document.createElement('div');
            logoItem.className = `p-3 rounded-lg flex items-center justify-between ${isActive ? 'bg-gray-200 border border-gray-400' : 'bg-gray-100'}`;
            
            logoItem.innerHTML = `
                <div class="flex items-center gap-4">
                    <img src="${logo.url}" alt="Logo" class="h-10 w-auto bg-gray-300 p-1 rounded">
                    <span class="font-medium truncate">${logo.name}</span>
                </div>
                <div class="flex items-center gap-3">
                    <label class="switch">
                        <input type="checkbox" class="select-logo-toggle" data-url="${logo.url}" ${isActive ? 'checked' : ''}>
                        <span class="slider"></span>
                    </label>
                    ${!logo.isDefault ? `
                    <button class="edit-logo-name-btn text-blue-500 hover:text-blue-700" data-id="${logo.id}" data-name="${logo.name}" title="Editar Nome">
                        <svg class="w-5 h-5 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                    </button>
                    <button class="delete-logo-btn text-red-500 hover:text-red-700" data-id="${logo.id}" title="Remover"><svg class="w-5 h-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                    ` : ''}
                </div>
            `;
            logoList.appendChild(logoItem);
        }


                





                function openLogoNameEditModal(id, currentName) {
            editCategoryModal.innerHTML = `
                <div class="modal-content max-w-lg">
                    <span class="close-button">&times;</span>
                    <h3 class="text-2xl font-bold mb-4">Editar Nome do Logo</h3>
                    <form id="logo-edit-form" class="space-y-6">
                        <input type="hidden" id="logo-id-edit" value="${id}">
                        <div>
                            <label for="logo-name-edit" class="block text-sodieText text-lg font-medium mb-2">Novo Nome:</label>
                            <input type="text" id="logo-name-edit" required class="w-full p-3 border" value="${currentName}">
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="button" class="cancel-btn bg-gray-300 text-sodieText px-6 py-3 rounded-full font-semibold">Cancelar</button>
                            <button type="submit" class="bg-sodiePrimary text-white px-6 py-3 rounded-full font-semibold">Salvar Alterações</button>
                        </div>
                    </form>
                </div>
            `;
            openCategoryEditModal();
            editCategoryModal.querySelector('.close-button').addEventListener('click', closeCategoryEditModal);
            editCategoryModal.querySelector('.cancel-btn').addEventListener('click', closeCategoryEditModal);
            document.getElementById('logo-edit-form').addEventListener('submit', handleLogoNameUpdate);
        }

        async function handleLogoNameUpdate(e) {
            e.preventDefault();
            const id = document.getElementById('logo-id-edit').value;
            let newName = document.getElementById('logo-name-edit').value.trim();
            if (!newName) {
                showModal('Erro', 'O nome do logo não pode estar vazio.', 'alert');
                return;
            }
            const saveBtn = e.target.querySelector('button[type="submit"]');
            saveBtn.disabled = true;
            saveBtn.textContent = 'A guardar...';

            try {
                const logoRef = doc(db, `artifacts/${appId}/public/data/logos`, id);
                await updateDoc(logoRef, { name: newName });
                showModal('Sucesso', 'Nome do logo atualizado!', 'alert');
                closeCategoryEditModal();
            } catch (error) {
                showModal('Erro', `Não foi possível guardar: ${error.message}`, 'alert');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Salvar Alterações';
            }
        }


        function openFaviconNameEditModal(id, currentName) {
    editCategoryModal.innerHTML = `
        <div class="modal-content max-w-lg">
            <span class="close-button">&times;</span>
            <h3 class="text-2xl font-bold mb-4">Editar Nome do Favicon</h3>
            <form id="favicon-edit-form" class="space-y-6">
                <input type="hidden" id="favicon-id-edit" value="${id}">
                <div>
                    <label for="favicon-name-edit" class="block text-sodieText text-lg font-medium mb-2">Novo Nome:</label>
                    <input type="text" id="favicon-name-edit" required class="w-full p-3 border" value="${currentName}">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" class="cancel-btn bg-gray-300 text-sodieText px-6 py-3 rounded-full font-semibold">Cancelar</button>
                    <button type="submit" class="bg-sodiePrimary text-white px-6 py-3 rounded-full font-semibold">Salvar Alterações</button>
                </div>
            </form>
        </div>
    `;
    openCategoryEditModal();
    editCategoryModal.querySelector('.close-button').addEventListener('click', closeCategoryEditModal);
    editCategoryModal.querySelector('.cancel-btn').addEventListener('click', closeCategoryEditModal);
    document.getElementById('favicon-edit-form').addEventListener('submit', handleFaviconNameUpdate);
}

async function handleFaviconNameUpdate(e) {
    e.preventDefault();
    const id = document.getElementById('favicon-id-edit').value;
    let newName = document.getElementById('favicon-name-edit').value.trim();
    if (!newName) {
        showModal('Erro', 'O nome do favicon não pode estar vazio.', 'alert');
        return;
    }
    const saveBtn = e.target.querySelector('button[type="submit"]');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Salvando...';

    try {
        const faviconRef = doc(db, `artifacts/${appId}/public/data/favicons`, id);
        await updateDoc(faviconRef, { name: newName });
        showModal('Sucesso', 'Nome do favicon atualizado!', 'alert');
        closeCategoryEditModal();
    } catch (error) { // <-- A CHAVE { FALTAVA AQUI
        showModal('Erro', `Não foi possível salvar: ${error.message}`, 'alert');
    } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Alterações';
    }
}

        

        







        customModal.querySelector('.close-button').addEventListener('click', closeModal);
        modalOkBtn.addEventListener('click', closeModal);


        function showModal(title, message, type, onConfirm = null) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message; // <-- Correção aqui
            modalConfirmBtn.onclick = null; 
            modalCancelBtn.onclick = null;

            modalConfirmBtn.classList.add('hidden');
            modalCancelBtn.classList.add('hidden');
            modalOkBtn.classList.add('hidden');

            if (type === 'alert') {
                modalOkBtn.classList.remove('hidden');
            } else if (type === 'confirm') {
                modalConfirmBtn.classList.remove('hidden');
                modalCancelBtn.classList.remove('hidden');
                modalConfirmBtn.onclick = () => {
                    if (onConfirm) onConfirm();
                    closeModal();
                };
                modalCancelBtn.onclick = closeModal;
            }
            customModal.style.display = 'flex'; 
        }

        function closeModal() { customModal.style.display = 'none'; }
        function openCategoryEditModal() { editCategoryModal.style.display = 'flex'; }
        function closeCategoryEditModal() { editCategoryModal.style.display = 'none'; }
        function openProductModal() { productModal.style.display = 'flex'; }
        function closeProductModal() { productModal.style.display = 'none'; }

        // --- LÓGICA DE AUTENTICAÇÃO E CONTROLE DE ACESSO ---
        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            crudContent.classList.add('hidden');
            // Esconde todos os ícones de ação do cabeçalho quando na tela de login
            logoutBtn.classList.add('hidden');
            adminLoginBtn.classList.add('hidden');
            adminGearBtn.classList.add('hidden');
        }

        function showCrudContent() {
            loginScreen.classList.add('hidden');
            crudContent.classList.remove('hidden');
            // Mostra os ícones corretos para admin logado
            logoutBtn.classList.remove('hidden');
            adminGearBtn.classList.remove('hidden'); // Mostra o ícone de gerenciar
            adminLoginBtn.classList.add('hidden'); // Garante que o de login está oculto
            mobileAdminGearLi.classList.remove('hidden'); // Mostra no menu mobile também
        }

        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, (user) => {
                    if (user && user.uid === ADMIN_UID) {
                        userId = user.uid;
                        showCrudContent();
                        saveCategoryAddBtn.disabled = false;
                        if (!isDataLoaded) {
                            getProducts();
                            getCategories();
                            getLogos(); // <-- ADICIONE ESTA LINHA
                            getContactInfo();
                            getBanners();
                            getSiteColors();
                            loadSiteSettings();
                            isDataLoaded = true;
                        }
                    } else {
                        if (user) signOut(auth);
                        showLoginScreen();
                        isDataLoaded = false;
                        saveCategoryAddBtn.disabled = true;
                    }


                    loadSiteSettings(); 
                });
            } catch (error) {
                showModal('Erro Crítico', `Ocorreu um erro na inicialização: ${error.message}.`, 'alert');
            }
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            loginError.classList.add('hidden');
            signInWithEmailAndPassword(auth, email, password)
                .catch(error => {
                    loginError.textContent = "Email ou senha inválidos.";
                    loginError.classList.remove('hidden');
                });
        });

        logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
        window.location.href = 'index.html';
    }).catch((error) => {
        console.error('Erro ao fazer logout:', error);
        // Garante o redirecionamento mesmo que o logout falhe por algum motivo de rede
        window.location.href = 'index.html';
    });
});

        // --- LÓGICA DE UPLOAD DE IMAGEM ---
        document.addEventListener('click', (e) => {
            if (e.target.closest('.remove-image-btn')) {
                const button = e.target.closest('.remove-image-btn');
                const index = parseInt(button.dataset.index, 10);
                const context = button.dataset.context;
                if (context === 'edit-existing') {
                    existingImageUrlsEdit.splice(index, 1);
                    renderEditImagePreviews();
                } else if (context === 'edit-new') {
                    newFilesToUploadEdit.splice(index, 1);
                    renderEditImagePreviews();
                }
            }
        });

        async function uploadToImgbb(file) {
            if (IMGBB_API_KEY === "SUA_CHAVE_DE_API_DO_IMGBB_AQUI") {
                throw new Error("Chave de API do imgbb não configurada no arquivo config.js");
            }
            const formData = new FormData();
            formData.append('image', file);

            const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                method: 'POST',
                body: formData,
            });

            const data = await response.json();
            if (!response.ok || !data.success) {
                throw new Error(data.error?.message || 'Falha no upload para o imgbb');
            }
            return data.data.url;
        }

        // --- Funções CRUD de Categorias (PÚBLICAS) ---
        categoryAddForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!userId) { showModal('Erro', 'Usuário não autenticado.', 'alert'); return; }
            let name = categoryNameAddInput.value.trim();
            if (!name) { showModal('Erro de Validação', 'Insira um nome para a categoria.', 'alert'); return; }
            name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
            saveCategoryAddBtn.textContent = 'Salvando...';
            saveCategoryAddBtn.disabled = true;
            try {
                await addDoc(collection(db, `artifacts/${appId}/public_categories`), { name, creatorId: userId, createdAt: new Date(), status: 'active' });
                showModal('Sucesso', 'Categoria adicionada!', 'alert');
                categoryAddForm.reset();
            } catch (error) {
                showModal('Erro', `Não foi possível adicionar a categoria: ${error.message}`, 'alert');
            } finally {
                saveCategoryAddBtn.textContent = 'Adicionar';
                saveCategoryAddBtn.disabled = !userId;
            }
        });

        function getCategories() {
            if (!db) return;
            const q = query(collection(db, `artifacts/${appId}/public_categories`));
            onSnapshot(q, (snapshot) => {
                loadingCategoriesMessage.style.display = 'none';
                categoriesList.innerHTML = ''; 
                
                availableCategoriesForDropdown = [];
                const activeCategoryNames = [];

                if (snapshot.empty) {
                    categoriesList.innerHTML = '<p class="text-center text-gray-500">Nenhuma categoria cadastrada.</p>';
                } else {
                    snapshot.forEach((docSnap) => {
                        const category = { id: docSnap.id, ...docSnap.data() };
                        availableCategoriesForDropdown.push(category); 
                        if (category.status !== 'inactive') {
                            activeCategoryNames.push(category.name);
                        }
                        
                        const categoryCard = document.createElement('div');
                        const isInactive = category.status === 'inactive';
                        categoryCard.className = `bg-gray-100 p-3 rounded-lg shadow-sm flex items-center justify-between ${isInactive ? 'opacity-50' : ''}`;
                        const toggleIcon = isInactive 
                            ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>`
                            : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" /><path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.742L2.335 6.578A10.025 10.025 0 01.458 10c1.274 4.057 5.022 7 9.542 7 .847 0 1.669-.105 2.454-.303z" /></svg>`;

                        categoryCard.innerHTML = `
                            <span class="font-medium">${category.name}</span>
                            <div class="flex space-x-3">
                                <button class="edit-category-btn text-blue-600 hover:text-blue-800 transition" data-id="${category.id}" title="Editar">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                                </button>
                                <button class="toggle-category-status-btn text-gray-600 hover:text-gray-800 transition" data-id="${category.id}" data-status="${category.status || 'active'}" title="${isInactive ? 'Ativar' : 'Inativar'}">
                                    ${toggleIcon}
                                </button>
                                <button class="delete-category-btn text-red-600 hover:text-red-800 transition" data-id="${category.id}" title="Remover">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                </button>
                            </div>`;
                        categoriesList.appendChild(categoryCard);
                    });
                }
                
                renderCategoryFiltersCrud(activeCategoryNames);

                document.querySelectorAll('.edit-category-btn').forEach(btn => btn.addEventListener('click', (e) => populateCategoryFormForEdit(e.target.closest('.edit-category-btn').dataset.id)));
                document.querySelectorAll('.toggle-category-status-btn').forEach(btn => btn.addEventListener('click', (e) => {
                    const button = e.target.closest('.toggle-category-status-btn');
                    toggleCategoryStatus(button.dataset.id, button.dataset.status);
                }));
                document.querySelectorAll('.delete-category-btn').forEach(btn => btn.addEventListener('click', (e) => {
                    const button = e.target.closest('.delete-category-btn');
                    showModal('Confirmar Exclusão', '<strong>Tem certeza que deseja remover esta categoria?</strong><br><small>Esta ação não pode ser desfeita.</small>', 'confirm', () => deleteCategory(button.dataset.id));
                }));
            }, (error) => {
                showModal('Erro', `Não foi possível carregar categorias: ${error.message}`, 'alert');
                loadingCategoriesMessage.style.display = 'none';
            });
        }

        


            categoryFiltersCrudContainer.addEventListener('click', (event) => {
            const target = event.target;
            if (target.classList.contains('filter-btn')) {
                // Atualiza qual botão está com a aparência de "ativo"
                categoryFiltersCrudContainer.querySelector('.active').classList.remove('active');
                target.classList.add('active');

                const selectedCategory = target.dataset.category;
                
                if (selectedCategory === 'Todos') {
                    displayProducts(allProducts); // Mostra todos os produtos
                } else {
                    // Filtra a lista de produtos e mostra apenas os da categoria selecionada
                    const filteredProducts = allProducts.filter(product => product.category === selectedCategory);
                    displayProducts(filteredProducts);
                }
            }
        });



        async function populateCategoryFormForEdit(id) {
            if (!db) return;
            const categoryRef = doc(db, `artifacts/${appId}/public_categories`, id);
            try {
                const categorySnap = await getDoc(categoryRef);
                if (categorySnap.exists()) {
                    const categoryData = categorySnap.data();
                    editCategoryModal.innerHTML = `
                        <div class="modal-content max-w-lg">
                            <span class="close-button">&times;</span>
                            <h3 class="text-2xl font-bold mb-4">Editar Categoria</h3>
                            <form id="category-edit-form" class="space-y-6">
                                <input type="hidden" id="category-id-edit" value="${id}">
                                <div>
                                    <label for="category-name-edit" class="block text-sodieText text-lg font-medium mb-2">Nome da Categoria:</label>
                                    <input type="text" id="category-name-edit" required class="w-full p-3 border" value="${categoryData.name}">
                                </div>
                                <div class="flex justify-end space-x-4">
                                    <button type="button" class="cancel-btn bg-gray-300 text-sodieText px-6 py-3 rounded-full font-semibold">Cancelar</button>
                                    <button type="submit" class="bg-sodiePrimary text-white px-6 py-3 rounded-full font-semibold">Salvar Alterações</button>
                                </div>
                            </form>
                        </div>
                    `;
                    openCategoryEditModal();
                    editCategoryModal.querySelector('.close-button').addEventListener('click', closeCategoryEditModal);
                    editCategoryModal.querySelector('.cancel-btn').addEventListener('click', closeCategoryEditModal);
                    document.getElementById('category-edit-form').addEventListener('submit', handleCategoryEditSubmit);
                }
            } catch (error) {
                showModal('Erro', `Não foi possível carregar a categoria: ${error.message}`, 'alert');
            }
        }

        async function handleCategoryEditSubmit(e) {
            e.preventDefault();
            if (!userId) return;
            const id = document.getElementById('category-id-edit').value;
            let name = document.getElementById('category-name-edit').value.trim();
            if (!name) {
                showModal('Erro', 'O nome da categoria não pode estar vazio.', 'alert');
                return;
            }
            name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
            const saveBtn = e.target.querySelector('button[type="submit"]');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Salvando...';

            try {
                const categoryRef = doc(db, `artifacts/${appId}/public_categories`, id);
                await updateDoc(categoryRef, { name, updatedAt: new Date() });
                showModal('Sucesso', 'Categoria atualizada!', 'alert');
                closeCategoryEditModal();
            } catch (error) {
                showModal('Erro', `Não foi possível salvar: ${error.message}`, 'alert');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Salvar Alterações';
            }
        }

        async function toggleCategoryStatus(id, currentStatus) {
            if (!userId) { showModal('Erro', 'Não autenticado.', 'alert'); return; }
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            try {
                const categoryRef = doc(db, `artifacts/${appId}/public_categories`, id);
                await updateDoc(categoryRef, { status: newStatus });
            } catch (error) { showModal('Erro', `Não foi possível alterar o status: ${error.message}`, 'alert'); }
        }
        
        // --- Funções CRUD de Produtos (COM UPLOAD) ---
        addProductBtn.addEventListener('click', () => openProductModalForAdd());

        

        function displayProducts(products) {
            productsList.innerHTML = ''; 
            if (products.length === 0) {
                productsList.innerHTML = '<p class="col-span-full text-center text-gray-500">Nenhum produto encontrado.</p>';
                return;
            }
            products.forEach(product => {
                const isInactive = product.status === 'inactive';
                const imageUrlToDisplay = (product.imageUrl && Array.isArray(product.imageUrl) && product.imageUrl.length > 0) ? product.imageUrl[0] : 'https://placehold.co/400x300/E0E0E0/808080?text=Sem+Imagem';
                const productCard = document.createElement('div');
                productCard.className = `bg-white rounded-lg shadow-md overflow-hidden flex flex-col ${isInactive ? 'opacity-50' : ''}`;
                
                const toggleIcon = isInactive 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" /><path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.742L2.335 6.578A10.025 10.025 0 01.458 10c1.274 4.057 5.022 7 9.542 7 .847 0 1.669-.105 2.454-.303z" /></svg>`;

                productCard.innerHTML = `
                    <img src="${imageUrlToDisplay}" alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="p-4 flex-grow flex flex-col">
                        <h3 class="text-xl font-semibold text-sodieText mb-2">${product.name}</h3>
                        <p class="text-sodiePrimary font-bold mb-2">R$ ${(product.price || 0).toFixed(2).replace('.', ',')}</p>
                        <p class="text-gray-500 text-xs mt-1 flex-grow">Categoria: ${product.category || 'N/A'}</p>
                    </div>
                    <div class="p-4 border-t border-gray-200 flex justify-end space-x-2">
                        <button class="edit-product-btn bg-sodieAccent text-sodieText p-2 rounded-full hover:bg-yellow-400 transition" data-id="${product.id}" title="Editar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                        </button>
                         <button class="toggle-product-status-btn text-white p-2 rounded-full ${isInactive ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-500 hover:bg-gray-600'} transition" data-id="${product.id}" data-status="${product.status || 'active'}" title="${isInactive ? 'Ativar' : 'Inativar'}">
                           ${toggleIcon}
                        </button>
                        <button class="delete-product-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition" data-id="${product.id}" title="Remover">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </div>`;
                productsList.appendChild(productCard);
            });
            
            document.querySelectorAll('.edit-product-btn').forEach(button => button.addEventListener('click', (e) => openProductModalForEdit(e.target.closest('.edit-product-btn').dataset.id)));
            document.querySelectorAll('.toggle-product-status-btn').forEach(button => button.addEventListener('click', (e) => toggleProductStatus(e.target.closest('.toggle-product-status-btn').dataset.id, e.target.closest('.toggle-product-status-btn').dataset.status)));
            document.querySelectorAll('.delete-product-btn').forEach(button => button.addEventListener('click', (e) => {
                const button = e.target.closest('.delete-product-btn');
                showModal('Confirmar Exclusão', '<strong>Tem certeza que deseja remover este produto?</strong><br><small>Esta ação não pode ser desfeita.</small>', 'confirm', () => deleteProduct(button.dataset.id));
            }));
        }


            function renderCategoryFiltersCrud(categories) {
            categoryFiltersCrudContainer.innerHTML = ''; // Limpa filtros antigos
            
            // Botão "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'filter-btn active';
            allButton.textContent = 'Todos';
            allButton.dataset.category = 'Todos';
            categoryFiltersCrudContainer.appendChild(allButton);

            // Botões para cada categoria
            categories.sort().forEach(categoryName => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = categoryName;
                button.dataset.category = categoryName;
                categoryFiltersCrudContainer.appendChild(button);
            });
        }

        
        
           



        function openProductModalForAdd() {
            existingImageUrlsEdit = [];
            newFilesToUploadEdit = [];
            
            let categoryOptions = '<option value="">Selecione uma categoria</option>';
            availableCategoriesForDropdown.forEach(cat => {
                categoryOptions += `<option value="${cat.name}">${cat.name}</option>`;
            });

            productModal.innerHTML = `
                <div class="modal-content max-w-3xl">
                    <span class="close-button">&times;</span>
                    <h3 class="text-2xl font-bold mb-4">Adicionar Novo Produto</h3>
                    <form id="product-form" class="space-y-6 text-left">
                        <input type="hidden" id="product-id-edit">
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label for="product-name" class="block text-sodieText text-lg font-medium mb-2">Nome:</label>
                                <input type="text" id="product-name" required class="w-full p-3 border">
                            </div>
                            <div>
                                <label for="product-category" class="block text-sodieText text-lg font-medium mb-2">Categoria:</label>
                                <select id="product-category" required class="w-full p-3 border">${categoryOptions}</select>
                            </div>
                            <div>
                                <label for="product-price" class="block text-sodieText text-lg font-medium mb-2">Preço:</label>
                                <input type="number" id="product-price" step="0.01" min="0" required class="w-full p-3 border">
                            </div>
                        </div>
                        <div>
                            <label for="product-description" class="block text-sodieText text-lg font-medium mb-2">Descrição:</label>
                            <textarea id="product-description" rows="3" class="w-full p-3 border"></textarea>
                        </div>
                        <div>
                            <label class="block text-sodieText text-lg font-medium mb-2">Imagens:</label>
                            <div id="file-upload-wrapper-edit" class="file-upload-wrapper">
                                <p>Clique para adicionar imagens</p>
                                <input type="file" id="product-images-edit" multiple accept="image/*" class="hidden">
                            </div>
                            <div id="image-preview-container-edit-new" class="image-preview-container"></div>
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="button" class="cancel-btn bg-gray-300 text-sodieText px-6 py-3 rounded-full font-semibold">Cancelar</button>
                            <button type="submit" id="save-product-btn" class="bg-sodiePrimary text-white px-6 py-3 rounded-full font-semibold">Adicionar Produto</button>
                        </div>
                    </form>
                </div>
            `;
            openProductModal();
            productModal.querySelector('.close-button').addEventListener('click', closeProductModal);
            productModal.querySelector('.cancel-btn').addEventListener('click', closeProductModal);
            document.getElementById('file-upload-wrapper-edit').addEventListener('click', () => document.getElementById('product-images-edit').click());
            document.getElementById('product-images-edit').addEventListener('change', (e) => {
                newFilesToUploadEdit = [...newFilesToUploadEdit, ...Array.from(e.target.files)];
                renderEditImagePreviews();
            });
            document.getElementById('product-form').addEventListener('submit', handleProductSubmit);
        }

        async function openProductModalForEdit(id) {
            if (!db) return;
            const productRef = doc(db, `artifacts/${appId}/public_products`, id);
            try {
                const productSnap = await getDoc(productRef);
                if (productSnap.exists()) {
                    const productData = productSnap.data();
                    existingImageUrlsEdit = [...(productData.imageUrl || [])];
                    newFilesToUploadEdit = [];

                    let categoryOptions = '<option value="">Selecione uma categoria</option>';
                    availableCategoriesForDropdown.forEach(cat => {
                        const selected = cat.name === productData.category ? 'selected' : '';
                        categoryOptions += `<option value="${cat.name}" ${selected}>${cat.name}</option>`;
                    });

                    productModal.innerHTML = `
                        <div class="modal-content max-w-3xl">
                            <span class="close-button">&times;</span>
                            <h3 class="text-2xl font-bold mb-4">Editar Produto</h3>
                            <form id="product-form" class="space-y-6 text-left">
                                <input type="hidden" id="product-id-edit" value="${id}">
                                <div class="grid md:grid-cols-3 gap-6">
                                    <div>
                                        <label for="product-name" class="block text-sodieText text-lg font-medium mb-2">Nome:</label>
                                        <input type="text" id="product-name" required class="w-full p-3 border" value="${productData.name}">
                                    </div>
                                    <div>
                                        <label for="product-category" class="block text-sodieText text-lg font-medium mb-2">Categoria:</label>
                                        <select id="product-category" required class="w-full p-3 border">${categoryOptions}</select>
                                    </div>
                                    <div>
                                        <label for="product-price" class="block text-sodieText text-lg font-medium mb-2">Preço:</label>
                                        <input type="number" id="product-price" step="0.01" min="0" required class="w-full p-3 border" value="${productData.price}">
                                    </div>
                                </div>
                                <div>
                                    <label for="product-description" class="block text-sodieText text-lg font-medium mb-2">Descrição:</label>
                                    <textarea id="product-description" rows="3" class="w-full p-3 border">${productData.description || ''}</textarea>
                                </div>
                                <div>
                                    <label class="block text-sodieText text-lg font-medium mb-2">Imagens Atuais:</label>
                                    <div id="image-preview-container-edit-existing" class="image-preview-container"></div>
                                    <label class="block text-sodieText text-lg font-medium mb-2 mt-4">Adicionar Novas Imagens:</label>
                                    <div id="file-upload-wrapper-edit" class="file-upload-wrapper">
                                        <p>Clique para adicionar novas imagens</p>
                                        <input type="file" id="product-images-edit" multiple accept="image/*" class="hidden">
                                    </div>
                                    <div id="image-preview-container-edit-new" class="image-preview-container"></div>
                                </div>
                                <div class="flex justify-end space-x-4">
                                    <button type="button" class="cancel-btn bg-gray-300 text-sodieText px-6 py-3 rounded-full font-semibold">Cancelar</button>
                                    <button type="submit" id="save-product-btn" class="bg-sodiePrimary text-white px-6 py-3 rounded-full font-semibold">Salvar Alterações</button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    renderEditImagePreviews();
                    openProductModal();

                    productModal.querySelector('.close-button').addEventListener('click', closeProductModal);
                    productModal.querySelector('.cancel-btn').addEventListener('click', closeProductModal);
                    document.getElementById('file-upload-wrapper-edit').addEventListener('click', () => document.getElementById('product-images-edit').click());
                    document.getElementById('product-images-edit').addEventListener('change', (e) => {
                        newFilesToUploadEdit = [...newFilesToUploadEdit, ...Array.from(e.target.files)];
                        renderEditImagePreviews();
                    });
                    document.getElementById('product-form').addEventListener('submit', handleProductSubmit);
                }
            } catch (error) { showModal('Erro', `Não foi possível carregar o produto: ${error.message}`, 'alert'); }
        }

        function renderEditImagePreviews() {
            const containerExisting = document.getElementById('image-preview-container-edit-existing');
            const containerNew = document.getElementById('image-preview-container-edit-new');
            if(containerExisting) {
                containerExisting.innerHTML = '';
                existingImageUrlsEdit.forEach((url, index) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `<img src="${url}" alt="Imagem existente"><div class="remove-image-btn" data-index="${index}" data-context="edit-existing">&times;</div>`;
                    containerExisting.appendChild(previewItem);
                });
            }
            if(containerNew) {
                containerNew.innerHTML = '';
                newFilesToUploadEdit.forEach((file, index) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `<img src="${URL.createObjectURL(file)}" alt="${file.name}"><div class="remove-image-btn" data-index="${index}" data-context="edit-new">&times;</div>`;
                    containerNew.appendChild(previewItem);
                });
            }
        }


                



        async function handleProductSubmit(e) {
            e.preventDefault();
            if (!userId) return;

            const id = document.getElementById('product-id-edit')?.value; // Pode ser nulo (adição)
            let name = document.getElementById('product-name').value.trim();
            name = name ? name.charAt(0).toUpperCase() + name.slice(1) : '';
            const category = document.getElementById('product-category').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value;
            
            const saveBtn = document.getElementById('save-product-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Salvando...';

            try {
                const uploadPromises = newFilesToUploadEdit.map(file => uploadToImgbb(file));
                const newImageUrls = await Promise.all(uploadPromises);
                const finalImageUrls = [...existingImageUrlsEdit, ...newImageUrls];

                if (finalImageUrls.length === 0) {
                    showModal('Erro', 'O produto deve ter pelo menos uma imagem.', 'alert');
                    saveBtn.disabled = false;
                    saveBtn.textContent = id ? 'Salvar Alterações' : 'Adicionar Produto';
                    return;
                }

                const productData = { name, category, price, description, imageUrl: finalImageUrls };

                if (id) { // Editando
                    productData.updatedAt = new Date();
                    const productRef = doc(db, `artifacts/${appId}/public_products`, id);
                    await updateDoc(productRef, productData);
                    showModal('Sucesso', 'Produto atualizado!', 'alert');
                } else { // Adicionando
                    productData.creatorId = userId;
                    productData.createdAt = new Date();
                    productData.status = 'active'; // Novo produto começa como ativo
                    await addDoc(collection(db, `artifacts/${appId}/public_products`), productData);
                    showModal('Sucesso', 'Produto adicionado!', 'alert');
                }
                
                closeProductModal();

            } catch (error) {
                showModal('Erro', `Não foi possível salvar: ${error.message}`, 'alert');
            } finally {
                saveBtn.disabled = false;
                 saveBtn.textContent = id ? 'Salvar Alterações' : 'Adicionar Produto';
            }
        }

        async function toggleProductStatus(id, currentStatus) {
            if (!userId) { showModal('Erro', 'Não autenticado.', 'alert'); return; }
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            try {
                const productRef = doc(db, `artifacts/${appId}/public_products`, id);
                await updateDoc(productRef, { status: newStatus });
            } catch (error) { showModal('Erro', `Não foi possível alterar o status: ${error.message}`, 'alert'); }
        }

       

        // --- Inicialização da Página e Listeners ---
           window.onload = () => {
            initializeFirebase();
            renderHoursSelector(); // <-- Adicione esta linha


            const faviconAddForm = document.getElementById('favicon-add-form');
    const faviconFileInput = document.getElementById('favicon-file-input');
    const faviconPreviewContainer = document.getElementById('favicon-preview-container');
    const faviconList = document.getElementById('favicon-list');
    let newFaviconFile = null;

    // --- ADIÇÃO PARA CORRIGIR O CLIQUE ---
        const faviconUploadWrapper = document.getElementById('favicon-upload-wrapper');
        if (faviconUploadWrapper) {
            faviconUploadWrapper.addEventListener('click', () => faviconFileInput.click());
        }

    // Listener para o formulário de adicionar favicon
    // ADICIONE ESTA LINHA ANTES DO LISTENER
        let isSubmittingFavicon = false; 

        // Listener para o formulário de adicionar favicon
        faviconAddForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // 1. VERIFICA A TRAVA
            if (isSubmittingFavicon) return; 

            const newName = document.getElementById('favicon-name-add').value.trim();
            if (!newFaviconFile) {
                showModal('Erro', 'Por favor, selecione uma imagem para o favicon.', 'alert');
                return;
            }
            if (!newName) {
                showModal('Erro', 'Por favor, insira um nome para o favicon.', 'alert');
                return;
            }
            const saveBtn = document.getElementById('save-favicon-add-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Enviando...';

            // 2. ATIVA A TRAVA
            isSubmittingFavicon = true;

            try {
                const uploadedUrl = await uploadToImgbb(newFaviconFile);
                await addDoc(collection(db, `artifacts/${appId}/public/data/favicons`), { name: newName, url: uploadedUrl });
                faviconAddForm.reset();
                faviconPreviewContainer.innerHTML = '';
                newFaviconFile = null;
                showModal('Sucesso', 'Novo favicon adicionado!', 'alert');
            } catch (error) {
                showModal('Erro', `Não foi possível adicionar o favicon: ${error.message}`, 'alert');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Adicionar Favicon';
                
                // 3. DESATIVA A TRAVA, independentemente de sucesso ou erro
                isSubmittingFavicon = false; 
            }
        });

    // Listener para o input de arquivo (mostrar preview) - ESTILO LOGO
        faviconFileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                newFaviconFile = e.target.files[0];
                // Gera o HTML idêntico ao do logo, usando a classe .remove-image-btn
                faviconPreviewContainer.innerHTML = `
                    <div class="image-preview-item">
                        <img src="${URL.createObjectURL(newFaviconFile)}" alt="Pré-visualização do Favicon">
                        <div class="remove-image-btn">&times;</div>
                    </div>
                `;
            }
        });

        // Listener para remover a imagem de preview - ESTILO LOGO
        faviconPreviewContainer.addEventListener('click', (e) => {
            // A lógica agora é idêntica à do logo, procurando pela classe .remove-image-btn
            if (e.target.classList.contains('remove-image-btn')) {
                newFaviconFile = null;
                faviconFileInput.value = '';
                faviconPreviewContainer.innerHTML = '';
            }
        });

// Função para limpar a pré-visualização do favicon (sem alterações)
function clearFaviconPreview() {
    const faviconPreviewContainer = document.getElementById('favicon-preview-container');
    const faviconFileInput = document.getElementById('favicon-file-input');
    const faviconUploadWrapper = document.getElementById('favicon-upload-wrapper');

    faviconPreviewContainer.innerHTML = '';
    faviconFileInput.value = ''; // Limpa o arquivo selecionado
    newFaviconFile = null;
    faviconUploadWrapper.style.display = 'flex'; // Exibe a área de upload novamente
}

    // Listener para a lista de favicons (ativar e deletar)
    faviconList.addEventListener('click', async (e) => {
        const target = e.target;
        const button = target.closest('button');
        const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);


        // Ativar ou desativar um favicon
            // Ativar um favicon
            if (target.classList.contains('select-favicon-toggle')) {
                const url = target.dataset.url;
                try {
                    // Apenas define a nova URL como ativa. O onSnapshot vai redesenhar a lista.
                    await setDoc(configRef, { faviconUrl: url }, { merge: true });
                } catch (error) {
                    showModal('Erro', `Não foi possível atualizar o favicon: ${error.message}`, 'alert');
                }
            }

            // ADIÇÃO: Lógica para editar o nome do favicon
            if (button && button.classList.contains('edit-favicon-name-btn')) {
                openFaviconNameEditModal(button.dataset.id, button.dataset.name);
            }

        // Deletar um favicon
            if (button && button.classList.contains('delete-favicon-btn')) {
                const idToDelete = button.dataset.id;
                const urlToDelete = button.dataset.url;

                showModal('Confirmar Exclusão', 'Tem certeza que deseja remover este favicon?', 'confirm', async () => {
                    try {
                        // Deleta o documento do favicon
                        await deleteDoc(doc(db, `artifacts/${appId}/public/data/favicons`, idToDelete));

                        // Se o favicon deletado era o ativo, reverte para o padrão
                        if (urlToDelete === currentActiveFaviconUrl) {
                            await setDoc(configRef, { faviconUrl: DEFAULT_FAVICON_URL }, { merge: true });
                            
                            // EXIBE A MENSAGEM APENAS NESTA CONDIÇÃO
                            showModal('Sucesso', 'Favicon removido. O padrão foi reativado.', 'alert');
                        }

                    } catch (error) {
                        showModal('Erro', `Não foi possível remover o favicon: ${error.message}`, 'alert');
                    }
                });
            }
    });


            // INÍCIO DO NOVO BLOCO: Listeners para a pré-visualização de cores
    if(previewPanel) {
        const updatePreviewColor = (variable, color) => {
            previewPanel.style.setProperty(variable, color);
        };

        primaryColorPicker.addEventListener('input', (e) => updatePreviewColor('--preview-color-primary', e.target.value));
        primaryColorHex.addEventListener('input', (e) => updatePreviewColor('--preview-color-primary', e.target.value));
        accentColorPicker.addEventListener('input', (e) => updatePreviewColor('--preview-color-accent', e.target.value));
        accentColorHex.addEventListener('input', (e) => updatePreviewColor('--preview-color-accent', e.target.value));
    }


footerPhoneInput.addEventListener('input', (e) => applyGenericPhoneMask(e.target)); // <-- Adicione esta linha
whatsappNumberInput.addEventListener('input', (e) => { if (whatsappDDISelect.value === 'BR') applyGenericPhoneMask(e.target); });



                    // Listeners para a ferramenta de horário em lote
        const selectAllDays = document.getElementById('select-all-days');
        const selectWeekdays = document.getElementById('select-weekdays');
        const selectWeekends = document.getElementById('select-weekends');
        const applyBatchHoursBtn = document.getElementById('apply-batch-hours-btn');

        function getDayCheckboxes(filter) {
            const all = hoursSelectorContainer.querySelectorAll('.day-selector input[type="checkbox"]');
            if (filter === 'weekdays') return Array.from(all).slice(0, 5);
            if (filter === 'weekends') return Array.from(all).slice(5);
            return all;
        }

        selectAllDays.addEventListener('change', (e) => { getDayCheckboxes().forEach(cb => cb.checked = e.target.checked); });
        selectWeekdays.addEventListener('change', (e) => { getDayCheckboxes('weekdays').forEach(cb => cb.checked = e.target.checked); });
        selectWeekends.addEventListener('change', (e) => { getDayCheckboxes('weekends').forEach(cb => cb.checked = e.target.checked); });

        applyBatchHoursBtn.addEventListener('click', () => {
            const startTime = document.getElementById('applicator-start-time').value;
            const endTime = document.getElementById('applicator-end-time').value;

            if (!startTime || !endTime) {
                showModal('Erro', 'Por favor, defina um horário de início e fim para aplicar.', 'alert');
                return;
            }

            hoursSelectorContainer.querySelectorAll('.day-selector input[type="checkbox"]:checked').forEach(checkbox => {
                const day = checkbox.dataset.day;
                const timeInputs = hoursSelectorContainer.querySelectorAll(`input[type="time"][data-day="${day}"]`);
                timeInputs.forEach(input => {
                    input.disabled = false;
                    if (input.dataset.type === 'start') input.value = startTime;
                    if (input.dataset.type === 'end') input.value = endTime;
                });
            });
        });




            // Adicione estes listeners para o gestor de cores
        colorsForm.addEventListener('submit', handleColorFormSubmit);
        primaryColorPicker.addEventListener('input', (e) => primaryColorHex.value = e.target.value);
        primaryColorHex.addEventListener('input', (e) => primaryColorPicker.value = e.target.value);
        accentColorPicker.addEventListener('input', (e) => accentColorHex.value = e.target.value);
        accentColorHex.addEventListener('input', (e) => accentColorPicker.value = e.target.value);


        


            // Adicione estes listeners para o banner
            saveBannerOrderBtn.addEventListener('click', saveBannerOrder);
            bannerForm.addEventListener('submit', handleBannerFormSubmit);
            bannerUploadWrapper.addEventListener('click', () => bannerFilesInput.click());
            bannerFilesInput.addEventListener('change', (e) => {
                newBannerFiles = Array.from(e.target.files);
                bannerNewPreviews.innerHTML = '';
                newBannerFiles.forEach((file, index) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `<img src="${URL.createObjectURL(file)}" alt="Preview"><div class="remove-image-btn" data-index="${index}" data-context="banner-new">&times;</div>`;
                    bannerNewPreviews.appendChild(previewItem);
                });
            });

            bannerNewPreviews.addEventListener('click', (e) => {
                if(e.target.classList.contains('remove-image-btn')) {
                    const indexToRemove = parseInt(e.target.dataset.index, 10);
                    newBannerFiles.splice(indexToRemove, 1);
                    const dataTransfer = new DataTransfer();
                    newBannerFiles.forEach(file => dataTransfer.items.add(file));
                    bannerFilesInput.files = dataTransfer.files;
                    bannerFilesInput.dispatchEvent(new Event('change'));
                }
            });

            bannerPreviewList.addEventListener('click', async (e) => {
                if (e.target.classList.contains('remove-banner-btn')) {
                    const urlToRemove = e.target.dataset.url;
                    showModal('Confirmar Exclusão', 'Tem certeza que deseja remover este banner?', 'confirm', async () => {
                        const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
                        try {
                            const configSnap = await getDoc(configRef);
                            const existingUrls = configSnap.exists() ? (configSnap.data().bannerUrls || []) : [];
                            const updatedUrls = existingUrls.filter(url => url !== urlToRemove);
                            await setDoc(configRef, { bannerUrls: updatedUrls }, { merge: true });
                            showModal('Sucesso', 'Banner removido.', 'alert');
                        } catch (error) {
                            showModal('Erro', `Não foi possível remover o banner: ${error.message}`, 'alert');
                        }
                    });
                }
            });

            // --- Lógica para as Gavetas (Acordeão) ---
            contactForm.addEventListener('click', (e) => {
                const header = e.target.closest('.accordion-header');
                if (!header) return;

                const accordionItem = header.parentElement;
                const content = accordionItem.querySelector('.accordion-content');
                
                accordionItem.classList.toggle('active');

                if (accordionItem.classList.contains('active')) {
                    content.style.maxHeight = content.scrollHeight + 'px';
                } else {
                    content.style.maxHeight = null;
                }
            });
    
contactForm.addEventListener('submit', handleContactFormSubmit);




// --- INÍCIO DA ALTERAÇÃO ---
            // Adiciona a lógica para ativar/desativar os horários
            hoursSelectorContainer.addEventListener('change', (e) => {
                if (e.target.matches('input[type="checkbox"]')) {
                    const day = e.target.dataset.day;
                    const timeInputs = hoursSelectorContainer.querySelectorAll(`input[type="time"][data-day="${day}"]`);
                    timeInputs.forEach(input => {
                        input.disabled = !e.target.checked;
                        if (!e.target.checked) {
                            input.value = ''; // Limpa o valor se o dia for desmarcado
                        }
                    });
                }
            });
            // --- FIM DA ALTERAÇÃO ---

            

                    // Listener para o filtro de categoria
            categoryFiltersCrudContainer.addEventListener('click', (event) => {
                const target = event.target;
                if (target.classList.contains('filter-btn')) {
                    const currentActive = categoryFiltersCrudContainer.querySelector('.active');
                    if(currentActive) currentActive.classList.remove('active');
                    target.classList.add('active');
                    applyFilters();
                }
            });

            // Listener para a busca por nome
            productSearchInput.addEventListener('input', applyFilters);

            // Listener do menu mobile
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                document.addEventListener('click', (event) => {
                    if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target)) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            }
        



                 // --- Lógica de Navegação do CRUD ---
            const mainNavContainer = document.getElementById('crud-nav');
            const mainTitle = document.getElementById('main-title');
            const backButton = document.getElementById('back-to-menu-btn');
            
            const sections = {
                main: document.querySelectorAll('.crud-section'),
                settings: document.querySelectorAll('.settings-content')
            };

            const buttons = {
                main: document.querySelectorAll('#crud-nav .crud-nav-btn'),
                settings: document.querySelectorAll('#settings-submenu .crud-nav-btn')
            };

            const settingsSubmenu = document.getElementById('settings-submenu');
            let currentView = 'main'; // Estados: 'main', 'settings_menu', 'settings_subsection', 'main_section'
            let isTransitioning = false; // Previne cliques duplos durante a animação

            function updateView(view, targetId = null) {
            if (isTransitioning) return;
            isTransitioning = true;

            const visibleElements = document.querySelectorAll('#crud-nav:not(.hidden), #settings-submenu:not(.hidden), .crud-section:not(.hidden), .settings-content:not(.hidden)');
            
            visibleElements.forEach(el => {
                el.classList.remove('animate-fade-in');
                el.classList.add('animate-fade-out');
            });

            setTimeout(() => {
                visibleElements.forEach(el => { 
                    el.classList.add('hidden'); 
                    el.classList.remove('animate-fade-out'); 
                });
                
                buttons.main.forEach(b => b.classList.remove('active'));
                buttons.settings.forEach(b => b.classList.remove('active'));

                currentView = view;
                let elementsToShow = [];
                let newTitle = 'Painel de Gerenciamento';

                switch(view) {
                    case 'main':
                        elementsToShow.push(mainNavContainer);
                        backButton.classList.add('hidden');
                        break;
                    case 'settings_menu':
                        elementsToShow.push(document.getElementById('settings-section'), settingsSubmenu);
                        backButton.classList.remove('hidden');
                        newTitle = 'Configurações do Site';
                        break;
                    case 'settings_subsection':
                        elementsToShow.push(document.getElementById('settings-section'), document.getElementById(targetId));
                        backButton.classList.remove('hidden');
                        newTitle = document.querySelector(`[data-target='${targetId}'] span`).textContent.trim();
                        break;
                    case 'main_section':
                        elementsToShow.push(document.getElementById(targetId));
                        backButton.classList.remove('hidden');
                        newTitle = document.querySelector(`[data-target='${targetId}'] span`).textContent.trim();
                        break;
                }
                
                // Anima o novo título
                mainTitle.classList.remove('animate-title-in');
                void mainTitle.offsetWidth; // Força o browser a "repintar" o elemento
                mainTitle.textContent = newTitle;
                mainTitle.classList.add('animate-title-in');

                elementsToShow.forEach(el => {
                    if (el) { 
                        el.classList.remove('hidden'); 
                        el.classList.add('animate-fade-in'); 
                    }
                });

                isTransitioning = false;
            }, visibleElements.length > 0 ? 300 : 0);
        }


            buttons.main.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;
                    if (targetId === 'settings-section') {
                        updateView('settings_menu');
                    } else {
                        updateView('main_section', targetId);
                    }
                });
            });

            buttons.settings.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;

                    if (targetId === 'logo-content') {
            getFavicons(); // Chama a função que gerencia os notificadores
            getLogos(); // É uma boa prática chamar a dos logos também
        }

                    // ADIÇÃO: Verifica se o alvo é a seção de cores
                    if (targetId === 'colors-content') {
                        // Chama a função para buscar as cores mais recentes do banco de dados
                        getSiteColors();
                    }

                    updateView('settings_subsection', targetId);
                });
            });

            backButton.addEventListener('click', () => {
                if (currentView === 'settings_subsection') {
                    updateView('settings_menu');
                } else if (currentView === 'settings_menu' || currentView === 'main_section') {
                    updateView('main');
                }
            });

            // Inicia a visualização no menu principal
            updateView('main');






            
            
            // Listeners para o formulário de Logo (única atribuição para evitar duplicados)
            logoUploadWrapper.addEventListener('click', () => logoFileInput.click());
            
            logoFileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    newLogoFile = e.target.files[0];
                    logoPreviewContainer.innerHTML = `
                        <div class="image-preview-item">
                            <img src="${URL.createObjectURL(newLogoFile)}" alt="Pré-visualização do Logo">
                            <div class="remove-image-btn" data-context="logo-new">&times;</div>
                        </div>
                    `;
                }
            });

            logoPreviewContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-image-btn')) {
                    newLogoFile = null;
                    logoFileInput.value = '';
                    logoPreviewContainer.innerHTML = '';
                }
            });

            logoAddForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newName = document.getElementById('logo-name-add').value.trim();
                if (!newLogoFile) {
                    showModal('Erro', 'Por favor, selecione uma imagem para o logo.', 'alert');
                    return;
                }
                if (!newName) {
                    showModal('Erro', 'Por favor, insira um nome para o logo.', 'alert');
                    return;
                }
                const saveBtn = document.getElementById('save-logo-add-btn');
                saveBtn.disabled = true;
                saveBtn.textContent = 'Enviando...';
                try {
                    const uploadedUrl = await uploadToImgbb(newLogoFile);
                    await addDoc(collection(db, `artifacts/${appId}/public/data/logos`), { name: newName, url: uploadedUrl });
                    logoAddForm.reset();
                    logoPreviewContainer.innerHTML = '';
                    newLogoFile = null;
                    logoFileInput.value = '';
                    showModal('Sucesso', 'Novo logo adicionado!', 'alert');
                } catch (error) {
                    showModal('Erro', `Não foi possível adicionar o logo: ${error.message}`, 'alert');
                } finally {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'Adicionar Logo';
                }
            });

            logoList.addEventListener('click', async (e) => {
                const target = e.target;
                const button = target.closest('button');

                if (target.classList.contains('select-logo-toggle')) {
                    const url = target.dataset.url;
                    const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
                    try {
                        await setDoc(configRef, { activeLogoUrl: url });
                    } catch (error) {
                        showModal('Erro', `Não foi possível atualizar o logo: ${error.message}`, 'alert');
                    }
                }
                
                if (button && button.classList.contains('edit-logo-name-btn')) {
                    openLogoNameEditModal(button.dataset.id, button.dataset.name);
                }

                if (button && button.classList.contains('delete-logo-btn')) {
                    const id = button.dataset.id;
                    const logoItem = button.closest('.p-3');
                    const toggle = logoItem.querySelector('.select-logo-toggle');
                    const urlToDelete = toggle.dataset.url;

                    showModal('Confirmar Exclusão', 'Tem certeza que deseja remover este logo?', 'confirm', async () => {
                        try {
                            await deleteDoc(doc(db, `artifacts/${appId}/public/data/logos`, id));
                            
                            if (urlToDelete === currentActiveLogoUrl) {
                                const configRef = doc(db, `artifacts/${appId}/public/data/config/site_settings`);
                                await setDoc(configRef, { activeLogoUrl: DEFAULT_LOGO_URL });
                                showModal('Sucesso', 'Logo removido. O logo padrão foi reativado.', 'alert');
                            }
                        } catch (error) {
                            showModal('Erro', `Não foi possível remover o logo: ${error.message}`, 'alert');
                        }
                    });
                }
            });
        };


    </script>
</body>
</html>
